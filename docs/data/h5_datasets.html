<!DOCTYPE html>
<html lang="en" data-accent-color="plum" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>H5 Dataset - mlcg 0.1.3 documentation</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Geometry and Neighbor lists" href="../geometry/index.html" /><link rel="prev" title="Fixed datasets" href="fixed_datasets.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=31853864" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=44020203" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="H5 Dataset"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>mlcg</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Data and datasets</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="atom_data.html">Molecular Data Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="fixed_datasets.html">Fixed datasets</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">H5 Dataset</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../geometry/index.html">Geometry and Neighbor lists</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../geometry/internal_coordinates.html">Internal Coordinate Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/neighbor_list.html">Neighbor Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/topology.html">Topology Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/statistics.html">Statistics Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../models/index.html">Model utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../models/priors.html">Priors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/cutoffs.html">Cutoff Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/rbfs.html">Radial Basis Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/mlip.html">MLIPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/wrappers.html">Gradient/sum wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models/losses.html">Loss Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulation/index.html">Simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simulation/langevin.html">Langevin Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/overdamped.html">Overdamped Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/parallel_tempering.html">Parallel Tempering Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/utils.html">Simulation utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">Miscellaneous utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../misc/coarse_graining.html">Coarse Graining</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/utils.html">General utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/mol_utils.html">Molecular utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Developer Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/doc.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/tests.html">Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#basic-bricks-moldata-and-metaset">Basic bricks: <code class="docutils literal notranslate"><span class="pre">MolData</span></code> and <code class="docutils literal notranslate"><span class="pre">MetaSet</span></code></a><ul>
<li><a class="reference internal" href="#train-test-split-partition">Train test split: <code class="docutils literal notranslate"><span class="pre">Partition</span></code></a></li>
<li><a class="reference internal" href="#full-dataset-h5dataset">Full Dataset: <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#loading-into-pytorch-h5partitiondataloader">Loading into PyTorch: <code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code></a></li>
<li><a class="reference internal" href="#detailed-docs">Detailed Docs</a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MolData"><code class="docutils literal notranslate"><span class="pre">MolData</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet"><code class="docutils literal notranslate"><span class="pre">MetaSet</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.create_from_hdf5_group"><code class="docutils literal notranslate">create_from_hdf5_group()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.grab_n_frames"><code class="docutils literal notranslate">grab_n_frames()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.retrieve_hdf"><code class="docutils literal notranslate">retrieve_hdf()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.trim_down_to"><code class="docutils literal notranslate">trim_down_to()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.Partition"><code class="docutils literal notranslate"><span class="pre">Partition</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.Partition.sampling_setup"><code class="docutils literal notranslate">sampling_setup()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5Dataset"><code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5Dataset.training_validation_splitting"><code class="docutils literal notranslate">training_validation_splitting()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5SimpleDataset"><code class="docutils literal notranslate"><span class="pre">H5SimpleDataset</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5SimpleDataset.get_dataloader"><code class="docutils literal notranslate">get_dataloader()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5PartitionDataLoader"><code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5MetasetDataLoader"><code class="docutils literal notranslate"><span class="pre">H5MetasetDataLoader</span></code></a></li>
</ul>
</li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">mlcg</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Data and datasets</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">H5 Dataset</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <article class="yue" role="main">
          <section id="h5-dataset">
<h1>H5 Dataset<a class="headerlink" href="#h5-dataset" title="Link to this heading">¶</a></h1>
<p><cite>mlcg.datasets.h5_dataset</cite> provides utilities so that users assemble their own curated dataset using an H5 format.
This allows for the possiblity of training on multiple types of molecules or data from different system conditiions.</p>
<p id="module-mlcg.datasets.h5_dataset">Python classes for processing data stored in HDF5 format.</p>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>HDF5 format benefits the dataset management for mlcg-tools when training/validation involves multiple molecules of vastly different lengths and when parallelization is used.
The main features are:</p>
<ol class="arabic simple">
<li><p>The internal structure mimics the hierarchy of the dataset itself, such that we don’t have to replicate it on filesystem.</p></li>
<li><p>we don’t have to actively open all files in the process</p></li>
<li><p>we can transparently load only the necessary part of the dataset to the memory</p></li>
</ol>
<p>This file contains the python data structures for handling the HDF5 file and its content, i.e., the coordinates, forces and embedding vectors for multiple CG molecules.
An example HDF5 file structure and correponding class types after loading:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">/ (HDF-group, =&gt; `H5Dataset._h5_root`)
</span><span data-line="2">├── OPEP (HDF-group =(part, according to &quot;partition_options&quot;)=&gt; `Metaset` in a `Partition`)
</span><span data-line="3">│   ├── opep_0000 (HDF-group, =&gt; `MolData`)
</span><span data-line="4">│   │   ├── attrs (HDF-attributes of the molecule &quot;/OPEP/opep_0000&quot;)
</span><span data-line="5">│   │   │   ├── cg_embeds (a 1-d numpy.int array)
</span><span data-line="6">│   │   │   ├── N_frames (int, number of frames = size of cg_coords on axis 0)
</span><span data-line="7">│   │   │   ... (optional, e.g., cg_top, cg_pdb, etc that corrsponds to the molecule)
</span><span data-line="8">│   │   ├── cg_coords (HDF-dataset of the molecule &quot;/OPEP/opep_0000&quot;, 3-d numpy.float32 array)
</span><span data-line="9">│   │   └── cg(_delta)_forces (HDF-dataset of the molecule &quot;/OPEP/opep_0000&quot;, 3-d numpy.float32 array)
</span><span data-line="10">│   ... (other molecules in &quot;/OPEP&quot;)
</span><span data-line="11">├── CATH (HDF-group =&quot;partition_options&quot;=&gt; `Metaset` in a `Partition`)
</span><span data-line="12">...
</span></pre></div>
</div>
</section>
<section id="basic-bricks-moldata-and-metaset">
<h2>Basic bricks: <code class="docutils literal notranslate"><span class="pre">MolData</span></code> and <code class="docutils literal notranslate"><span class="pre">MetaSet</span></code><a class="headerlink" href="#basic-bricks-moldata-and-metaset" title="Link to this heading">¶</a></h2>
<p>Data structure <code class="docutils literal notranslate"><span class="pre">MolData</span></code> is the basic brick of the dataset.
It holds embeds, coords and forces of certain number of frames for a single molecule.
.sub_sample: method for performing indexing on the frames.</p>
<p>Data strucuture <code class="docutils literal notranslate"><span class="pre">Metaset</span></code> holds multiple molecules and joins their frame indices together.
One can access frames of underlying MolData objects with a continuous index.
The idea is that the molecules in a <code class="docutils literal notranslate"><span class="pre">Metaset</span></code> have similar numbers of CG beads, such that the sample requires similar processing time when passing through a neural network.
When this rule is enforced, it will allow automatic balancing of batch composition during training and validation.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.create_from_hdf5_group</span></code>: initiate a Metaset by loading data from given HDF-group.mol_list, detailed_indices, hdf_key_mapping, stride and parallel can control which subset is loaded to the Metaset (details see the description of “H5Dataset”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.trim_down_to</span></code>: drop frames of underlying for obtaining a subset with desired number of frames. The indices of frames to be dropped are controlled by a random number generator. When the parameter “random_seed” and the MolData order and number of frames are the same, the frames to be dropped will be reproducible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">len()</span> <span class="pre">(__len__)</span></code>: return total number of samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[]</span> <span class="pre">(__get_item__)</span></code>: infer the molecule and get the corresponding frame according to the given unified index. Return value is grouped by an <code class="docutils literal notranslate"><span class="pre">AtomicData</span></code> object.</p></li>
</ul>
<section id="train-test-split-partition">
<h3>Train test split: <code class="docutils literal notranslate"><span class="pre">Partition</span></code><a class="headerlink" href="#train-test-split-partition" title="Link to this heading">¶</a></h3>
<p>Data structure <code class="docutils literal notranslate"><span class="pre">Partition</span></code> can hold multiple Metaset for training and validation purposes.
Its main function is to automatic adjust (subsample) the Metaset(s) and the underlying MolData to form a balanced data source, from which a certain number of batches can be drawn. Each batch will contain a pre-given number of samples from each Metaset.
One or several <code class="docutils literal notranslate"><span class="pre">Partition``s</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">created</span> <span class="pre">to</span> <span class="pre">load</span> <span class="pre">part</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">HDF5</span> <span class="pre">file</span> <span class="pre">into</span> <span class="pre">the</span> <span class="pre">memory.</span>
<span class="pre">The</span> <span class="pre">exact</span> <span class="pre">content</span> <span class="pre">inside</span> <span class="pre">a</span> <span class="pre">``Partition</span></code> object is controlled by the <code class="docutils literal notranslate"><span class="pre">partition_options</span></code> as a parameter for initializing a <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code>.</p>
</section>
<section id="full-dataset-h5dataset">
<h3>Full Dataset: <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code><a class="headerlink" href="#full-dataset-h5dataset" title="Link to this heading">¶</a></h3>
<p>Data strcuture <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code> opens a HDF5 file and establish the partitions.
<code class="docutils literal notranslate"><span class="pre">partition_options</span></code> describe what partitions to create and what content to load into them. (Detailed description and examples are as followed.)
<code class="docutils literal notranslate"><span class="pre">loading_options</span></code> mainly deal with the HDF key mapping (which datasets/attributes corresponds to the coordinates, forces and embeddings) as well as (optionally) the information for correctly split the dataset in a parallel training/validation.</p>
<p>An example “partition_options” (as a Python Mappable (e.g., dict)):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">        <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="3">                <span class="s2">&quot;metasets&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="4">                        <span class="s2">&quot;OPEP&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="5">                                <span class="s2">&quot;molecules&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span data-line="6">                                        <span class="s2">&quot;opep_0000&quot;</span><span class="p">,</span>
</span><span data-line="7">                                        <span class="s2">&quot;opep_0001&quot;</span><span class="p">,</span>
</span><span data-line="8">                                        <span class="o">...</span>
</span><span data-line="9">                                <span class="p">],</span>
</span><span data-line="10">                                <span class="s2">&quot;stride&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># optional, default 1</span>
</span><span data-line="11">                                <span class="s2">&quot;detailed_indices&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="12">                <span class="c1"># optional, providing the indices of frames to work with (before striding and splitting for parallel processes).</span>
</span><span data-line="13">                                        <span class="c1"># optional,</span>
</span><span data-line="14">                    <span class="s2">&quot;opep_0000&quot;</span><span class="p">:</span>
</span><span data-line="15">                        <span class="n">val_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="16">                        <span class="n">test_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="17">                        <span class="n">seed</span><span class="p">:</span> <span class="mi">12345</span>
</span><span data-line="18">                    <span class="s2">&quot;opep_0001&quot;</span><span class="p">:</span>
</span><span data-line="19">                        <span class="n">val_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="20">                        <span class="n">test_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="21">                        <span class="n">seed</span><span class="p">:</span> <span class="mi">12345</span>
</span><span data-line="22">                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="o">./</span><span class="n">splits</span>
</span><span data-line="23">
</span><span data-line="24">                <span class="c1"># If detailed_indices are not provided for a given molecule, then it is equivalent to np.arange(N_frames)</span>
</span><span data-line="25">                                            <span class="s2">&quot;opep_0000&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span data-line="26">
</span><span data-line="27">
</span><span data-line="28">                                <span class="p">},</span>
</span><span data-line="29">                        <span class="p">},</span>
</span><span data-line="30">                        <span class="s2">&quot;CATH&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="31">                                <span class="s2">&quot;molecules&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span data-line="32">                                        <span class="s2">&quot;cath_1b43A02&quot;</span><span class="p">,</span>
</span><span data-line="33">                                        <span class="o">...</span>
</span><span data-line="34">                                <span class="p">],</span>
</span><span data-line="35">                                <span class="s2">&quot;stride&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># optional</span>
</span><span data-line="36">                                <span class="s2">&quot;detailed_indices&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="c1"># optional</span>
</span><span data-line="37">                        <span class="p">}</span>
</span><span data-line="38">                <span class="p">},</span>
</span><span data-line="39">                <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="40">                        <span class="c1"># each batch will contain 24 samples from</span>
</span><span data-line="41">                        <span class="c1"># The two metasets will be trimmed down according to this ratio</span>
</span><span data-line="42">                        <span class="c1"># so optimally it should be proportional to the ratio of numbers of frames in the metasets.</span>
</span><span data-line="43">                        <span class="s2">&quot;OPEP&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
</span><span data-line="44">                        <span class="s2">&quot;CATH&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
</span><span data-line="45">                <span class="p">},</span>
</span><span data-line="46">                <span class="s2">&quot;subsample_random_seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="c1"># optional, default 42. Random seed for trimming down the frames.</span>
</span><span data-line="47">                <span class="s2">&quot;max_epoch_samples&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># optional, default None. For setting a desired dataset size.</span>
</span><span data-line="48">                <span class="c1"># Works by subsampling the dataset after it is loaded with the given stride.</span>
</span><span data-line="49">        <span class="p">},</span>
</span><span data-line="50">        <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># similar</span>
</span><span data-line="51">        <span class="p">}</span>
</span><span data-line="52"><span class="p">}</span>
</span></pre></div>
</div>
<p>An example “loading_options” (as a Python Mappable (e.g., dict)):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">        <span class="s2">&quot;hdf_key_mapping&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="3">                <span class="c1"># keys for reading CG data from HDF5 groups</span>
</span><span data-line="4">                <span class="s2">&quot;embeds&quot;</span><span class="p">:</span> <span class="s2">&quot;attrs:cg_embeds&quot;</span><span class="p">,</span>
</span><span data-line="5">                <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="s2">&quot;cg_coords&quot;</span><span class="p">,</span>
</span><span data-line="6">                <span class="s2">&quot;forces&quot;</span><span class="p">:</span> <span class="s2">&quot;cg_delta_forces&quot;</span><span class="p">,</span>
</span><span data-line="7">        <span class="p">},</span>
</span><span data-line="8">        <span class="s2">&quot;parallel&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># optional, default rank=0 and world_size=1 (single process).</span>
</span><span data-line="9">                <span class="c1"># For split the dataset evenly and load only the necessary parts to each process in a parallelized train/val setup</span>
</span><span data-line="10">                <span class="s2">&quot;rank&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># which process is this</span>
</span><span data-line="11">                <span class="s2">&quot;world_size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># how many processes are there</span>
</span><span data-line="12">        <span class="p">}</span>
</span><span data-line="13"><span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="loading-into-pytorch-h5partitiondataloader">
<h2>Loading into PyTorch: <code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code><a class="headerlink" href="#loading-into-pytorch-h5partitiondataloader" title="Link to this heading">¶</a></h2>
<p>Class <code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code> mimics the pytorch data loader and can generate training/validation batches with fixed proportion of samples from several Metasets in a Partition.
The proportion and batch size is defined when the partition is initialized.
When the molecules in each Metaset have similar embedding vector lengths, the processing of output batches will require a more or less fixed size of VRAM on GPU, which can benefit the</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Usually in a train-val split, each molecule goes to either the train or the test partition.
In some special cases (e.g., non-transferable training) one molecule can be part of both partitions.
In this situation, “detailed_indices” can be set to assign the corresponding frames to the desired partitions.</p>
</div>
</section>
<section id="detailed-docs">
<h2>Detailed Docs<a class="headerlink" href="#detailed-docs" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MolData">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">MolData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embeds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclusion_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#MolData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MolData" title="Link to this definition">¶</a></dt>
<dd><p>Data-holder for coordinates, forces and embedding vector of a molecule, e.g., cath_1b43A02.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Name of the molecule</p></li>
<li><p><strong>embeds</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – Type embeddings for each atom, of shape <cite>(n_atoms,)</cite></p></li>
<li><p><strong>coords</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – Cartesian coordinates of the molecule, of shape <cite>(n_frames, n_atoms, 3)</cite></p></li>
<li><p><strong>forces</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – Cartesian forces of the molecule, of shape <cite>(n_frames, n_atoms, 3)</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">MetaSet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#MetaSet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet" title="Link to this definition">¶</a></dt>
<dd><p>Set of MolData instances for molecules with similar characterstics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – Name of the metaset</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.create_from_hdf5_group">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">create_from_hdf5_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdf5_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detailed_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdf_key_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'coords':</span> <span class="pre">'cg_coords',</span> <span class="pre">'embeds':</span> <span class="pre">'attrs:cg_embeds',</span> <span class="pre">'forces':</span> <span class="pre">'cg_delta_forces',</span> <span class="pre">'weights':</span> <span class="pre">'subsampling_weights'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'rank':</span> <span class="pre">0,</span> <span class="pre">'world_size':</span> <span class="pre">1}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_listed_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#MetaSet.create_from_hdf5_group"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.create_from_hdf5_group" title="Link to this definition">¶</a></dt>
<dd><p>initiate a Metaset by loading data from given HDF-group.
mol_list, detailed_indices, hdf_key_mapping, stride and parallel can control which subset is loaded to the Metaset (details see the description of “H5Dataset”)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.grab_n_frames">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">grab_n_frames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdf5_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#MetaSet.grab_n_frames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.grab_n_frames" title="Link to this definition">¶</a></dt>
<dd><p>Returns number of frames for each mol name</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.retrieve_hdf">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">retrieve_hdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdf_grp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdf_key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#MetaSet.retrieve_hdf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.retrieve_hdf" title="Link to this definition">¶</a></dt>
<dd><p>Unified hdf retriever for attributes and dataset.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.trim_down_to">
<span class="sig-name descname"><span class="pre">trim_down_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_n_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#MetaSet.trim_down_to"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.trim_down_to" title="Link to this definition">¶</a></dt>
<dd><p>Trimming all datasets randomly to reach the target number of samples.
MolData attributes of the MetaSet are permanently subsampled by this
method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.Partition">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">Partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#Partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.Partition" title="Link to this definition">¶</a></dt>
<dd><p>Contain several metasets for a certain purpose, e.g., training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – name of the partition</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.Partition.sampling_setup">
<span class="sig-name descname"><span class="pre">sampling_setup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_sizes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_epoch_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#Partition.sampling_setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.Partition.sampling_setup" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the number of batches available for an epoch according to
the batch size for each metaset and optionally the maximum number of
samples in an epoch. The molecular dataset will be trimmed accordingly.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5Dataset">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5Dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h5_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_options</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loading_options</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_listed_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#H5Dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5Dataset" title="Link to this definition">¶</a></dt>
<dd><p>The top-level class for handling multiple datasets contained in a HDF5 file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>h5_file_path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Path to the hdf5 file containing the dataset(s)</p></li>
<li><p><strong>partition_options</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></span>) – Dictionary of partition names mapping to collections of metaset information</p></li>
<li><p><strong>loading_options</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></span>) – Dictionary of options specifying how hdf5 attrs/datasets are named
within hd5 groups</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5Dataset.training_validation_splitting">
<span class="sig-name descname"><span class="pre">training_validation_splitting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_detailed_indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">part_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metaset_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#H5Dataset.training_validation_splitting"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5Dataset.training_validation_splitting" title="Link to this definition">¶</a></dt>
<dd><p>Option to split molecule in metaset frame by frame into training or validation
Inputs:</p>
<blockquote>
<div><dl class="simple">
<dt>input_detailed_indices –</dt><dd><dl class="simple">
<dt>dictionary read in from yaml file about how data should be split</dt><dd><p>must contain 3 primary keys [val_ratio, test_ratio, seed]
additional option to write out to filename if in dict.keys()</p>
</dd>
</dl>
</dd>
<dt>part_name –</dt><dd><p>which partition is currently being examined</p>
</dd>
<dt>metaset_name –</dt><dd><p>global name describing class of molecules</p>
</dd>
<dt>mol_list –</dt><dd><p>names of molecules</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Outputs:</dt><dd><dl class="simple">
<dt>self._detailed_indices[part_name][metaset_name] –</dt><dd><p>pass back indices according to queried metaset and partition</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5SimpleDataset">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5SimpleDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h5_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detailed_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metaset_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdf_key_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'coords':</span> <span class="pre">'cg_coords',</span> <span class="pre">'embeds':</span> <span class="pre">'attrs:cg_embeds',</span> <span class="pre">'forces':</span> <span class="pre">'cg_delta_forces'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'rank':</span> <span class="pre">0,</span> <span class="pre">'world_size':</span> <span class="pre">1}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_listed_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#H5SimpleDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5SimpleDataset" title="Link to this definition">¶</a></dt>
<dd><p>The top-level class for handling a single dataset contained in a HDF5 file.
Will only load from one single type of molecules (i.e., one Metaset), and do
not support partition splits.
Use .get_dataloader for obtaining a dataloader for PyTorch training, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>h5_file_path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Path to the hdf5 file containing the dataset(s)</p></li>
<li><p><strong>stride</strong> (<em>default 1</em>) – Stride for loading the frames</p></li>
<li><p><strong>detailed_indices</strong> (default <cite>None</cite>) – Set this to manually define which frames to be included for each molecule.</p></li>
<li><p><strong>metaset_name</strong> (default <cite>None</cite>) – the name of the h5 group containing the molecule data. If kept <cite>None</cite> and
the given file consists of only one metaset, this parameter will be
inferred from the file.</p></li>
<li><p><strong>mol_list</strong> (default <cite>None</cite>) – A list of the molecules to be loaded. When kept <cite>None</cite>, all molecules will
be loaded.</p></li>
<li><p><strong>hdf_key_mapping</strong> (<em>default loading the delta forces</em>) – Key mapping for reading the data from h5 file.</p></li>
<li><p><strong>parallel</strong> (<em>default for single process</em>) – For DDP parallelism. Details see the head of this file.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5SimpleDataset.get_dataloader">
<span class="sig-name descname"><span class="pre">get_dataloader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collater_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;torch_geometric.loader.dataloader.Collater</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#H5SimpleDataset.get_dataloader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5SimpleDataset.get_dataloader" title="Link to this definition">¶</a></dt>
<dd><section id="parameters">
<h3>Parameters:<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h3>
<p>batch_size:
Size of the batches to draw from the metaset
collater_fn, shuffle, pin_memory:
See PyTorch documentations for dataloader options.</p>
</section>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5PartitionDataLoader">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5PartitionDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collater_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;torch_geometric.loader.dataloader.Collater</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#H5PartitionDataLoader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5PartitionDataLoader" title="Link to this definition">¶</a></dt>
<dd><p>Load batches from one or multiple Metasets in a Partition.
In multiple Metasets scenario, the order of data loaders will be
alphabetically ascending with respect to the Metaset names.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5MetasetDataLoader">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5MetasetDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metaset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collater_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;torch_geometric.loader.dataloader.Collater</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlcg/datasets/h5_dataset.html#H5MetasetDataLoader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5MetasetDataLoader" title="Link to this definition">¶</a></dt>
<dd><p>Load batches from one Metaset. For kwargs/options, see
<a class="reference external" href="https://pytorch.org/docs/stable/data.html?highlight=dataset#torch.utils.data.Dataset">https://pytorch.org/docs/stable/data.html?highlight=dataset#torch.utils.data.Dataset</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metaset</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></span>) – Dataset object for a single set of molecules</p></li>
<li><p><strong>batch_size</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Size of the batches to draw from the metaset</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="fixed_datasets.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Fixed datasets</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="../geometry/index.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Geometry and Neighbor lists</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Clementi Group</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=360bc84d"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>