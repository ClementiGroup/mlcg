<!DOCTYPE html>
<html lang="en" data-accent-color="plum" data-content_root="./">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>API Reference - mlcg 0.1.3 documentation</title><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="_static/pygments.css?v=31853864" />
    <link rel="stylesheet" type="text/css" href="_static/shibuya.css?v=44020203" />
    <link media="print" rel="stylesheet" type="text/css" href="_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="API Reference"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="index.html">
      
      
      <strong>mlcg</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><ul>
<li class="toctree-l1"><a class="reference internal" href="data/index.html">Data and datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data/atom_data.html">Molecular Data Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="data/fixed_datasets.html">Fixed datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="data/h5_datasets.html">H5 Dataset</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="geometry/index.html">Geometry and Neighbor lists</a><ul>
<li class="toctree-l2"><a class="reference internal" href="geometry/internal_coordinates.html">Internal Coordinate Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry/neighbor_list.html">Neighbor Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry/topology.html">Topology Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry/statistics.html">Statistics Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="models/index.html">Model utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="models/priors.html">Priors</a></li>
<li class="toctree-l2"><a class="reference internal" href="models/cutoffs.html">Cutoff Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="models/rbfs.html">Radial Basis Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="models/mlip.html">MLIPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="models/wrappers.html">Gradient/sum wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="models/losses.html">Loss Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation/index.html">Simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simulation/langevin.html">Langevin Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation/overdamped.html">Overdamped Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation/parallel_tempering.html">Parallel Tempering Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation/utils.html">Simulation utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="misc/index.html">Miscellaneous utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="misc/coarse_graining.html">Coarse Graining</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc/utils.html">General utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc/mol_utils.html">Molecular utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev/index.html">Developer Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev/doc.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev/tests.html">Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#atomic-data">Atomic Data</a><ul>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData"><code class="docutils literal notranslate"><span class="pre">AtomicData</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.pos"><code class="docutils literal notranslate">pos</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.atom_types"><code class="docutils literal notranslate">atom_types</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.masses"><code class="docutils literal notranslate">masses</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.pbc"><code class="docutils literal notranslate">pbc</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.cell"><code class="docutils literal notranslate">cell</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.tag"><code class="docutils literal notranslate">tag</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.energy"><code class="docutils literal notranslate">energy</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.forces"><code class="docutils literal notranslate">forces</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.velocities"><code class="docutils literal notranslate">velocities</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.neighbor_list"><code class="docutils literal notranslate">neighbor_list</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.batch"><code class="docutils literal notranslate">batch</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.from_ase"><code class="docutils literal notranslate">from_ase()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.data.atomic_data.AtomicData.from_points"><code class="docutils literal notranslate">from_points()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#coarse-graining-utilities">Coarse Graining Utilities</a><ul>
<li><a class="reference internal" href="#mlcg.cg.projection.build_cg_matrix"><code class="docutils literal notranslate"><span class="pre">build_cg_matrix()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.cg.projection.build_cg_topology"><code class="docutils literal notranslate"><span class="pre">build_cg_topology()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.cg.projection.build_opeps_connectivity_matrix"><code class="docutils literal notranslate"><span class="pre">build_opeps_connectivity_matrix()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.cg.projection.isolate_features"><code class="docutils literal notranslate"><span class="pre">isolate_features()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.cg.projection.make_non_bonded_set"><code class="docutils literal notranslate"><span class="pre">make_non_bonded_set()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.cg.projection.make_opep_residue_indices"><code class="docutils literal notranslate"><span class="pre">make_opep_residue_indices()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.cg.projection.swap_mapping_rows"><code class="docutils literal notranslate"><span class="pre">swap_mapping_rows()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#models">Models</a><ul>
<li><a class="reference internal" href="#mlcg.nn.schnet.AttentiveSchNet"><code class="docutils literal notranslate"><span class="pre">AttentiveSchNet</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.schnet.CFConv"><code class="docutils literal notranslate"><span class="pre">CFConv</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.schnet.CFConv.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.schnet.CFConv.message"><code class="docutils literal notranslate">message()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.schnet.CFConv.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.schnet.InteractionBlock"><code class="docutils literal notranslate"><span class="pre">InteractionBlock</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.schnet.InteractionBlock.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.schnet.SchNet"><code class="docutils literal notranslate"><span class="pre">SchNet</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.schnet.SchNet.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.schnet.SchNet.neighbor_list"><code class="docutils literal notranslate">neighbor_list()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.schnet.SchNet.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.schnet.StandardSchNet"><code class="docutils literal notranslate"><span class="pre">StandardSchNet</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNN"><code class="docutils literal notranslate"><span class="pre">PaiNN</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNN.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNN.neighbor_list"><code class="docutils literal notranslate">neighbor_list()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNN.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction"><code class="docutils literal notranslate"><span class="pre">PaiNNInteraction</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction.aggregate"><code class="docutils literal notranslate">aggregate()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction.message"><code class="docutils literal notranslate">message()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction.update"><code class="docutils literal notranslate">update()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNMixing"><code class="docutils literal notranslate"><span class="pre">PaiNNMixing</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNMixing.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.painn.PaiNNMixing.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.painn.StandardPaiNN"><code class="docutils literal notranslate"><span class="pre">StandardPaiNN</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.mace.CustomRealAgnosticResidualInteractionBlock"><code class="docutils literal notranslate"><span class="pre">CustomRealAgnosticResidualInteractionBlock</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.mace.CustomRealAgnosticResidualInteractionBlock.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.mace.MACE"><code class="docutils literal notranslate"><span class="pre">MACE</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.mace.MACE.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.mace.MACE.neighbor_list"><code class="docutils literal notranslate">neighbor_list()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.mace.StandardMACE"><code class="docutils literal notranslate"><span class="pre">StandardMACE</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-mlcg.nn.radial_basis.radial_integral_gto">Radial basis functions</a><ul>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis"><code class="docutils literal notranslate"><span class="pre">RIGTOBasis</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis.plot"><code class="docutils literal notranslate">plot()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_normal.ExpNormalBasis"><code class="docutils literal notranslate"><span class="pre">ExpNormalBasis</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_normal.ExpNormalBasis.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_normal.ExpNormalBasis.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis"><code class="docutils literal notranslate"><span class="pre">ExtendedExpNormalBasis</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis.extended_initial_params"><code class="docutils literal notranslate">extended_initial_params()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.gaussian.GaussianBasis"><code class="docutils literal notranslate"><span class="pre">GaussianBasis</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.gaussian.GaussianBasis.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.gaussian.GaussianBasis.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis"><code class="docutils literal notranslate"><span class="pre">SpacedExpBasis</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis.reset_parameters"><code class="docutils literal notranslate">reset_parameters()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.angular_basis.spherical_harmonics.SphericalHarmonics"><code class="docutils literal notranslate"><span class="pre">SphericalHarmonics</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.angular_basis.spherical_harmonics.SphericalHarmonics.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-mlcg.nn.cutoff">Cutoff functions</a><ul>
<li><a class="reference internal" href="#mlcg.nn.cutoff.CosineCutoff"><code class="docutils literal notranslate"><span class="pre">CosineCutoff</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.cutoff.CosineCutoff.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.cutoff.IdentityCutoff"><code class="docutils literal notranslate"><span class="pre">IdentityCutoff</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.cutoff.IdentityCutoff.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.nn.cutoff.ShiftedCosineCutoff"><code class="docutils literal notranslate"><span class="pre">ShiftedCosineCutoff</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.nn.cutoff.ShiftedCosineCutoff.forward"><code class="docutils literal notranslate">forward()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-mlcg.datasets.chignolin">Datasets</a><ul>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDataset"><code class="docutils literal notranslate"><span class="pre">ChignolinDataset</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDataset.download"><code class="docutils literal notranslate">download()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDataset.kB"><code class="docutils literal notranslate">kB</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDataset.process"><code class="docutils literal notranslate">process()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDataset.processed_file_names"><code class="docutils literal notranslate">processed_file_names</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDataset.raw_file_names"><code class="docutils literal notranslate">raw_file_names</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDataset.temperature"><code class="docutils literal notranslate">temperature</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.chignolin.ChignolinDatasetWithDihedralPriors"><code class="docutils literal notranslate"><span class="pre">ChignolinDatasetWithDihedralPriors</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset"><code class="docutils literal notranslate"><span class="pre">AlanineDataset</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.download"><code class="docutils literal notranslate">download()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.kB"><code class="docutils literal notranslate">kB</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.load_original_topology"><code class="docutils literal notranslate">load_original_topology()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_baseline_models"><code class="docutils literal notranslate">make_baseline_models()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_cg_topology"><code class="docutils literal notranslate">make_cg_topology()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_data_slices_prior"><code class="docutils literal notranslate">make_data_slices_prior()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_priors"><code class="docutils literal notranslate">make_priors()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.process"><code class="docutils literal notranslate">process()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.processed_file_names"><code class="docutils literal notranslate">processed_file_names</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.raw_file_names"><code class="docutils literal notranslate">raw_file_names</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.repulsion_nls"><code class="docutils literal notranslate">repulsion_nls()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.save_dataset"><code class="docutils literal notranslate">save_dataset()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.temperature"><code class="docutils literal notranslate">temperature</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#basic-bricks-moldata-and-metaset">Basic bricks: <code class="docutils literal notranslate"><span class="pre">MolData</span></code> and <code class="docutils literal notranslate"><span class="pre">MetaSet</span></code></a><ul>
<li><a class="reference internal" href="#train-test-split-partition">Train test split: <code class="docutils literal notranslate"><span class="pre">Partition</span></code></a></li>
<li><a class="reference internal" href="#full-dataset-h5dataset">Full Dataset: <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#loading-into-pytorch-h5partitiondataloader">Loading into PyTorch: <code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5Dataset"><code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5Dataset.training_validation_splitting"><code class="docutils literal notranslate">training_validation_splitting()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5MetasetDataLoader"><code class="docutils literal notranslate"><span class="pre">H5MetasetDataLoader</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5PartitionDataLoader"><code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5SimpleDataset"><code class="docutils literal notranslate"><span class="pre">H5SimpleDataset</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.H5SimpleDataset.get_dataloader"><code class="docutils literal notranslate">get_dataloader()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet"><code class="docutils literal notranslate"><span class="pre">MetaSet</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.create_from_hdf5_group"><code class="docutils literal notranslate">create_from_hdf5_group()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.grab_n_frames"><code class="docutils literal notranslate">grab_n_frames()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.retrieve_hdf"><code class="docutils literal notranslate">retrieve_hdf()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MetaSet.trim_down_to"><code class="docutils literal notranslate">trim_down_to()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.MolData"><code class="docutils literal notranslate"><span class="pre">MolData</span></code></a></li>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.Partition"><code class="docutils literal notranslate"><span class="pre">Partition</span></code></a><ul>
<li><a class="reference internal" href="#mlcg.datasets.h5_dataset.Partition.sampling_setup"><code class="docutils literal notranslate">sampling_setup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#neighbor-list">Neighbor List</a><ul>
<li><a class="reference internal" href="#mlcg.neighbor_list.neighbor_list.atomic_data2neighbor_list"><code class="docutils literal notranslate"><span class="pre">atomic_data2neighbor_list()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.neighbor_list.make_neighbor_list"><code class="docutils literal notranslate"><span class="pre">make_neighbor_list()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.neighbor_list.validate_neighborlist"><code class="docutils literal notranslate"><span class="pre">validate_neighborlist()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.compute_images"><code class="docutils literal notranslate"><span class="pre">compute_images()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.get_j_idx"><code class="docutils literal notranslate"><span class="pre">get_j_idx()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.safe_radius"><code class="docutils literal notranslate"><span class="pre">safe_radius()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.safe_radius_graph"><code class="docutils literal notranslate"><span class="pre">safe_radius_graph()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.strides_of"><code class="docutils literal notranslate"><span class="pre">strides_of()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.torch_neighbor_list"><code class="docutils literal notranslate"><span class="pre">torch_neighbor_list()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.torch_neighbor_list_no_pbc"><code class="docutils literal notranslate"><span class="pre">torch_neighbor_list_no_pbc()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.torch_neighbor_list_pbc"><code class="docutils literal notranslate"><span class="pre">torch_neighbor_list_pbc()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.neighbor_list.torch_impl.wrap_positions"><code class="docutils literal notranslate"><span class="pre">wrap_positions()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.geometry.internal_coordinates.compute_angles_cos"><code class="docutils literal notranslate"><span class="pre">compute_angles_cos()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.geometry.internal_coordinates.compute_angles_raw"><code class="docutils literal notranslate"><span class="pre">compute_angles_raw()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.geometry.internal_coordinates.compute_distance_vectors"><code class="docutils literal notranslate"><span class="pre">compute_distance_vectors()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.geometry.internal_coordinates.compute_distances"><code class="docutils literal notranslate"><span class="pre">compute_distances()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.geometry.internal_coordinates.compute_torsions"><code class="docutils literal notranslate"><span class="pre">compute_torsions()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.geometry.internal_coordinates.safe_norm"><code class="docutils literal notranslate"><span class="pre">safe_norm()</span></code></a></li>
<li><a class="reference internal" href="#mlcg.geometry.internal_coordinates.safe_normalization"><code class="docutils literal notranslate"><span class="pre">safe_normalization()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#simulations">Simulations</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">mlcg</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">API Reference</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <article class="yue" role="main">
          <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading">¶</a></h1>
<p>TODO: split this file into respective files where both API reference and some more high level information is provided to the reader.</p>
<section id="atomic-data">
<h2>Atomic Data<a class="headerlink" href="#atomic-data" title="Link to this heading">¶</a></h2>
<p>TODO: describe the data structure and its use.</p>
<dl class="py class" id="module-mlcg.data.atomic_data">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.data.atomic_data.</span></span><span class="sig-name descname"><span class="pre">AtomicData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/data/atomic_data.html#AtomicData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData" title="Link to this definition">¶</a></dt>
<dd><p>A data object holding atomic structures.
The attribute names are defined in <code class="xref py py-data docutils literal notranslate"><span class="pre">mlcg.data._keys</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.pos">
<span class="sig-name descname"><span class="pre">pos</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.pos" title="Link to this definition">¶</a></dt>
<dd><p>set of atomic positions in each structures</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_atoms * n_structures, 3]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.atom_types">
<span class="sig-name descname"><span class="pre">atom_types</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.atom_types" title="Link to this definition">¶</a></dt>
<dd><p>if atoms then it’s the atomic number, if it’s a CG bead then it’s a number defined by the CG mapping</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_atoms * n_structures]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.masses">
<span class="sig-name descname"><span class="pre">masses</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.masses" title="Link to this definition">¶</a></dt>
<dd><p>Masses of each atom</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_atoms * n_structures]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.pbc">
<span class="sig-name descname"><span class="pre">pbc</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.pbc" title="Link to this definition">¶</a></dt>
<dd><p>periodic boundary conditions</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_structures, 3] (Optional)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.cell">
<span class="sig-name descname"><span class="pre">cell</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.cell" title="Link to this definition">¶</a></dt>
<dd><p>unit cell of the atomic structure. Lattice vectors are defined row wise</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_structures, 3, 3] (Optional)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.tag">
<span class="sig-name descname"><span class="pre">tag</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.tag" title="Link to this definition">¶</a></dt>
<dd><p>metadata about each structure</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_structures] (Optional)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.energy">
<span class="sig-name descname"><span class="pre">energy</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.energy" title="Link to this definition">¶</a></dt>
<dd><p>reference energy associated with each structures</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_structures] (Optional)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.forces">
<span class="sig-name descname"><span class="pre">forces</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.forces" title="Link to this definition">¶</a></dt>
<dd><p>reference forces associated with each structures</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_atoms * n_structures, 3] (Optional)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.velocities">
<span class="sig-name descname"><span class="pre">velocities</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.velocities" title="Link to this definition">¶</a></dt>
<dd><p>velocities associated with each structure</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[n_atoms * n_structures, 3] (optional)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.neighbor_list">
<span class="sig-name descname"><span class="pre">neighbor_list</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.neighbor_list" title="Link to this definition">¶</a></dt>
<dd><p>contains information about the connectivity formatted according to
<span class="xref std std-ref">mlcg.neighbor_list.neighbor_list.make_neighbor_list</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[str, Dict[str, Any]] (Optional)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.batch">
<span class="sig-name descname"><span class="pre">batch</span></span><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.batch" title="Link to this definition">¶</a></dt>
<dd><p>maps the atoms to their structure index (from 0 to n_structures-1)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>[<a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology.n_atoms" title="mlcg.geometry.topology.Topology.n_atoms">n_atoms</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.from_ase">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">from_ase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">energy_tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'energy'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'forces'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/data/atomic_data.html#AtomicData.from_ase"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.from_ase" title="Link to this definition">¶</a></dt>
<dd><p>Method for constructing an AtomicData instance from
an ASE Atoms instance. Atom types are taken from atomic
numbers, while periodic flags, masses, cell vectors, and
configuration tags are taken from the ASE Atoms attributes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>frame</strong> – Input ase.atom.Atoms instance</p></li>
<li><p><strong>energy_tag</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – String value used to access the ASE energy</p></li>
<li><p><strong>force_tag</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – String value used to access the ASE forces</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Populated AtomicData instance</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.data.atomic_data.AtomicData.from_points">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">from_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atom_types</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">masses</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">energy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">velocities</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighborlist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/data/atomic_data.html#AtomicData.from_points"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.data.atomic_data.AtomicData.from_points" title="Link to this definition">¶</a></dt>
<dd><p>Method for constructing an AtomicData instance directly
from input tensors</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pos</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Cartesian coordinates of a single configuration, of shape
(n_atoms, 3)</p></li>
<li><p><strong>atom_types</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Atom type labels of shape (n_atoms)</p></li>
<li><p><strong>masses</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – Atom masses of shape (n_atoms)</p></li>
<li><p><strong>pbc</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – Period boundary condition flags for the frame</p></li>
<li><p><strong>cell</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – Box vectors for the configuration, for computing periodic
images, of shape (3,3)</p></li>
<li><p><strong>tag</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) – String tag for the configuration</p></li>
<li><p><strong>energy</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – Reference scalar energy for the configuration</p></li>
<li><p><strong>forces</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – Reference cartesian forces for the configuration, of
shape (n_atoms, 3)</p></li>
<li><p><strong>velocities</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – Atomic velocities, of shape (n_atoms, 3)</p></li>
<li><p><strong>neighborlist</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]]</span>) – Neighborlist dictionary for tagged features. Eg,</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Populated AtomicData instance</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="coarse-graining-utilities">
<h2>Coarse Graining Utilities<a class="headerlink" href="#coarse-graining-utilities" title="Link to this heading">¶</a></h2>
<p>TODO: document the CG mapping format.</p>
<dl class="py function" id="module-mlcg.cg.projection">
<dt class="sig sig-object py" id="mlcg.cg.projection.build_cg_matrix">
<span class="sig-prename descclassname"><span class="pre">mlcg.cg.projection.</span></span><span class="sig-name descname"><span class="pre">build_cg_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cg_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">special_terminal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/cg/projection.html#build_cg_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.cg.projection.build_cg_matrix" title="Link to this definition">¶</a></dt>
<dd><p>Function for producing coarse grain types, masses, and
mapping matrices using a slicing strategy and a predetermined
set of atoms to retain at the coarse grain resolution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topology</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>) – System topology instance</p></li>
<li><p><strong>cg_mapping</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]]</span>) – <p>Mapping dictionary with the following structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">    <span class="p">(</span><span class="n">residue</span> <span class="n">name</span><span class="p">,</span> <span class="n">atom</span> <span class="n">name</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">compound</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>
</span><span data-line="3">    <span class="o">...</span>
</span><span data-line="4"><span class="p">}</span>
</span></pre></div>
</div>
<p>Eg, a row for an alanine carbon alpha atom would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">    <span class="p">(</span><span class="s2">&quot;ALA&quot;</span><span class="p">,</span> <span class="s2">&quot;CA&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="s2">&quot;CA_A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</span><span data-line="3">    <span class="o">...</span>
</span><span data-line="4"><span class="p">}</span>
</span></pre></div>
</div>
</p></li>
<li><p><strong>special_termini</strong> – If True, special types will be reserved for the first and
last CG atoms</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">OrderedDict</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>np.ndarray</em> – Array of CG atom types</p></li>
<li><p><em>np.ndarray</em> – Array of CG masses</p></li>
<li><p><em>np.ndarray</em> – One-hot transformation matrix of shape (n_high_res_atoms, n_cg_atoms)
that maps atoms for the high resolution repesentation to the coarse
grain representation</p></li>
<li><p><em>OrderedDict</em> – Ordered dictionary mapping each CG atom index (with respect to the
CG topology) to a list containing the CG atom name, CG atom type
and the CG atom mass</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.cg.projection.build_cg_topology">
<span class="sig-prename descclassname"><span class="pre">mlcg.cg.projection.</span></span><span class="sig-name descname"><span class="pre">build_cg_topology</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cg_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">special_terminal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bonds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;function</span> <span class="pre">add_chain_bonds&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">angles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;function</span> <span class="pre">add_chain_angles&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dihedrals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;function</span> <span class="pre">add_chain_dihedrals&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/cg/projection.html#build_cg_topology"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.cg.projection.build_cg_topology" title="Link to this definition">¶</a></dt>
<dd><p>Takes an <cite>mlcg.geometry.topology.Topology</cite> instance and returns another
<cite>mlcg.geometry.topology.Topology</cite> instance conditioned on the supplied
CG mapping</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topology</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>) – Original MLCG topology before coarse graining</p></li>
<li><p><strong>cg_mapping</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]]</span>) – A suitable CG mapping. See mclg.cg._mapping.py for examples.</p></li>
<li><p><strong>special_termini</strong> – If True, the first and last CG atoms recieve their own special
types</p></li>
<li><p><strong>bonds</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>]</span>) – Function to enumerate and define bonds in the final CG topology</p></li>
<li><p><strong>angles</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>]</span>) – Function to enumerate and define angles in the final CG topology</p></li>
<li><p><strong>dihedrals</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code>]</span>) – Function to enumerate and define dihedrals in the final CG topology</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>CG topoology</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology">Topology</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.cg.projection.build_opeps_connectivity_matrix">
<span class="sig-prename descclassname"><span class="pre">mlcg.cg.projection.</span></span><span class="sig-name descname"><span class="pre">build_opeps_connectivity_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resnames</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/cg/projection.html#build_opeps_connectivity_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.cg.projection.build_opeps_connectivity_matrix" title="Link to this definition">¶</a></dt>
<dd><p>Builds bonded connectivity matrix for (N,CA,CB,C,O)
octapeptide CG mapping scheme, based on amino acid sequence.
GLY residues are constructed as (N,CA,C,O).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>resnames</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) – List of three letter amino acid strings that specify
the protein/peptide sequence.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Undirected graph connectivity matrix for the specified sequence
of residues.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>connectivity_matrix</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.cg.projection.isolate_features">
<span class="sig-prename descclassname"><span class="pre">mlcg.cg.projection.</span></span><span class="sig-name descname"><span class="pre">isolate_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_atoms_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full_feature_set</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/cg/projection.html#isolate_features"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.cg.projection.isolate_features" title="Link to this definition">¶</a></dt>
<dd><p>Helper function for isolating molecular features from
specified lists of beads.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_atoms_list</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]]</span>) – if a feature atom from full_feature_set is in this list, that corresponding feature
is moved to the isolated feature list. If no feature atom is in this list,
then the corresponding feature remains in the bulk feature list</p></li>
<li><p><strong>full_feature_set</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – The set of full features that is checked against the target_atoms</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of N feature sets, where the length of target_atoms_list is N-1 in length,
the first N-1 features sets correspond to those isolated features, and the final
feauture set is the list of bulk/non-isolated features.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>feature_sets</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.cg.projection.make_non_bonded_set">
<span class="sig-prename descclassname"><span class="pre">mlcg.cg.projection.</span></span><span class="sig-name descname"><span class="pre">make_non_bonded_set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minimum_separation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residue_indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residue_exclusion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_exclusion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/cg/projection.html#make_non_bonded_set"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.cg.projection.make_non_bonded_set" title="Link to this definition">¶</a></dt>
<dd><p>Helper function for constructing non-bonded sets from a topology</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topology;</strong> – input topology</p></li>
<li><p><strong>minimum_separation</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – minimum edge separation between pairs of atoms for the non-bonded set</p></li>
<li><p><strong>residue_indices</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – list of indices mapping atoms to residue indices</p></li>
<li><p><strong>residue_exclusion</strong> – if True, an extra exclusion rule is applied such that if any two atoms are within
the same residue they are automatically removed from the non-bonded set.</p></li>
<li><p><strong>edge_exclusion</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]]</span>) – if None, this list of pairwise edge indices will be excluded from the non-bonded
set.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The set of non-bonded edges</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>non_bonded_edges</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.cg.projection.make_opep_residue_indices">
<span class="sig-prename descclassname"><span class="pre">mlcg.cg.projection.</span></span><span class="sig-name descname"><span class="pre">make_opep_residue_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resnames</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/cg/projection.html#make_opep_residue_indices"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.cg.projection.make_opep_residue_indices" title="Link to this definition">¶</a></dt>
<dd><p>Helper method to make residue index lists, which specify
the residue index that a given atom belongs to in an
octapeptide topology using the octapeptide CG mapping, wherein
non-glycine amino acids are given a 5 atom mapping (N,CA,CB,C,O)
while glycines are given a 4 atom mapping (N,CA,C,O).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>resnames</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) – List of three letter amino acid codes that together specify
the molecular sequence</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of residue indices that specify which specify to which residue
an atom belongs</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>residue_indices</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.cg.projection.swap_mapping_rows">
<span class="sig-prename descclassname"><span class="pre">mlcg.cg.projection.</span></span><span class="sig-name descname"><span class="pre">swap_mapping_rows</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_atoms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">types</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">masses</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/cg/projection.html#swap_mapping_rows"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.cg.projection.swap_mapping_rows" title="Link to this definition">¶</a></dt>
<dd><p>Helper function to swap atom rows systematically in
the specified residue. The last four arguments are the
outputs of mlcg.cg.projection.build_cg_matrix().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topology</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>) – Topology of the all-atom (non-CG system).</p></li>
<li><p><strong>residue</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Three letter amino acid string specifying the
residue in which swaps must be made</p></li>
<li><p><strong>target_atoms</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) – List of atom types to swap places</p></li>
<li><p><strong>types</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – The types array that will by swapped at the
specified atoms for the specified residue</p></li>
<li><p><strong>masses</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – The mass array that will be swapped at the
specified atoms for the specified residue</p></li>
<li><p><strong>matrix</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – The CG mapping matrix for which rows will be
swapped at the specified atoms for the specifed
residue</p></li>
<li><p><strong>mapping</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrderedDict</span></code></span>) – The mapping dictionary from the original topology
to the CG atoms</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>swapped_types</em></p></li>
<li><p><em>swapped_masses</em></p></li>
<li><p><em>swapped_matrix</em></p></li>
<li><p><em>generalized_mapping</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="models">
<h2>Models<a class="headerlink" href="#models" title="Link to this heading">¶</a></h2>
<p>Neural network models for coarse grain property predictions</p>
<dl class="py class" id="module-mlcg.nn.schnet">
<dt class="sig sig-object py" id="mlcg.nn.schnet.AttentiveSchNet">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.schnet.</span></span><span class="sig-name descname"><span class="pre">AttentiveSchNet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rbf_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_hidden_layer_widths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_features_in</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_features_out</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_residual_q</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_residual_k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_residual_v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attention_block</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_filters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_interactions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">Tanh()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_widths</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_first</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'add'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attention_version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'normal'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#AttentiveSchNet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.AttentiveSchNet" title="Link to this definition">¶</a></dt>
<dd><p>Small wrapper class for <span class="xref std std-ref">mlcg.nn.SchNet</span> to simplify the definition of the
SchNet model with an Interaction block that includes attention through an input file. The upper distance cutoff attribute
in is set by default to match the upper cutoff value in the cutoff function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rbf_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – radial basis function used to project the distances <span class="math notranslate nohighlight">\(r_{ij}\)</span>.</p></li>
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – smooth cutoff function to supply to the CFConv</p></li>
<li><p><strong>output_hidden_layer_widths</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – List giving the number of hidden nodes of each hidden layer of the MLP
used to predict the target property from the learned representation.</p></li>
<li><p><strong>num_features_in</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – size of each input sample for linear layer</p></li>
<li><p><strong>num_features_out</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – size of each output sample for liner layer</p></li>
<li><p><strong>num_residuals_q</strong> – Number of residual blocks applied to features via self-attention
for queries, keys, and values</p></li>
<li><p><strong>num_residuals_k</strong> – Number of residual blocks applied to features via self-attention
for queries, keys, and values</p></li>
<li><p><strong>num_residuals_v</strong> – Number of residual blocks applied to features via self-attention
for queries, keys, and values</p></li>
<li><p><strong>attention_block</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Specify if you want to use softmax attention (input: ExactAttention) or favor+ (input: FavorAttention)</p></li>
<li><p><strong>hidden_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – dimension of the learned representation, i.e. dimension of the embeding projection, convolution layers, and interaction block.</p></li>
<li><p><strong>embedding_size</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – dimension of the input embeddings (should be larger than <code class="xref py py-obj docutils literal notranslate"><span class="pre">AtomicData.atom_types.max()+1</span></code>).</p></li>
<li><p><strong>num_filters</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – number of nodes of the networks used to filter the projected distances</p></li>
<li><p><strong>num_interactions</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – number of interaction blocks</p></li>
<li><p><strong>activation</strong> – activation function</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – The maximum number of neighbors to return for each atom in <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code>.
If the number of actual neighbors is greater than
<code class="xref py py-obj docutils literal notranslate"><span class="pre">max_num_neighbors</span></code>, returned neighbors are picked randomly.</p></li>
<li><p><strong>aggr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Aggregation scheme for continuous filter output. For all options,
see <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/notes/create_gnn.html?highlight=MessagePassing#the-messagepassing-base-class">here</a>
for more options.</p></li>
<li><p><strong>activation_first</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – Inverting the order of linear layers and activation functions.</p></li>
<li><p><strong>attention_version</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Specifiy which interaction block architecture to choose. By default normal.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.schnet.CFConv">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.schnet.</span></span><span class="sig-name descname"><span class="pre">CFConv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filter_network</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">in_channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_filters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'add'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#CFConv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.CFConv" title="Link to this definition">¶</a></dt>
<dd><p>Continuous filter convolutions for <cite>SchNet</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filter_net</strong> – Neural network for generating filters from expanded pairwise distances</p></li>
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Cutoff envelope to apply to the output of the filter generating network.</p></li>
<li><p><strong>in_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Hidden input dimensions</p></li>
<li><p><strong>out_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Hidden output dimensions</p></li>
<li><p><strong>num_filters</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Number of filters</p></li>
<li><p><strong>aggr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Aggregation scheme for continuous filter output. For all options,
see <cite>here &lt;https://pytorch-geometric.readthedocs.io/en/latest/notes/create_gnn.html?highlight=MessagePassing#the-messagepassing-base-class&gt;</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.schnet.CFConv.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_attr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#CFConv.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.CFConv.forward" title="Link to this definition">¶</a></dt>
<dd><p>Forward pass through the continuous filter convolution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Embedded features of shape (num_examples * num_atoms,
hidden_channels)</p></li>
<li><p><strong>edge_index</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Graph edge index tensor of shape (2, total_num_edges)</p></li>
<li><p><strong>edge_weight</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Graph edge weight (eg, distances), of shape (total_num_edges)</p></li>
<li><p><strong>edge_attr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Graph edge attributes (eg, expanded distances), of shape
(total_num_edges, num_rbf)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Updated embedded features of shape (num_examples * num_atoms,
hidden_channels)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>x</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.schnet.CFConv.message">
<span class="sig-name descname"><span class="pre">message</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">W</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#CFConv.message"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.CFConv.message" title="Link to this definition">¶</a></dt>
<dd><p>Message passing operation to perform the continuous filter
convolution through element-wise multiplcation of embedded
features with the output of the filter network.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_j</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of embedded features of shape (total_num_edges,
hidden_channels)</p></li>
<li><p><strong>W</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of filter values of shape (total_num_edges, num_filters)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Elementwise multiplication of the filters with embedded features.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>x_j * W</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.schnet.CFConv.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#CFConv.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.CFConv.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method for resetting the weights of the linear
layers and filter network according the the
Xavier uniform strategy. Biases
are set to 0.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.schnet.InteractionBlock">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.schnet.</span></span><span class="sig-name descname"><span class="pre">InteractionBlock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfconv_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">Tanh()</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#InteractionBlock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.InteractionBlock" title="Link to this definition">¶</a></dt>
<dd><p>Interaction blocks for SchNet. Consists of atomwise
transformations of embedded features that are continuously
convolved with filters generated from radial basis function-expanded
pairwise distances.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cfconv_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Continuous filter convolution layer for convolutions of radial basis
function-expanded distances with embedded features</p></li>
<li><p><strong>hidden_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Hidden dimension of embedded features</p></li>
<li><p><strong>activation</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Activation function applied to linear layer outputs</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.schnet.InteractionBlock.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_attr</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#InteractionBlock.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.InteractionBlock.forward" title="Link to this definition">¶</a></dt>
<dd><p>Forward pass through the interaction block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Embedded features of shape (num_examples, num_atoms,
hidden_channels)</p></li>
<li><p><strong>edge_index</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Graph edge index tensor of shape (2, total_num_edges)</p></li>
<li><p><strong>edge_weight</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Graph edge weight (eg, distances), of shape (total_num_edges)</p></li>
<li><p><strong>edge_attr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Graph edge attributes (eg, expanded distances), of shape
(total_num_edges, num_rbf)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Updated embedded features of shape (num_examples * num_atoms,
hidden_channels)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>x</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.schnet.SchNet">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.schnet.</span></span><span class="sig-name descname"><span class="pre">SchNet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embedding_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interaction_blocks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rbf_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_network</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_interaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#SchNet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.SchNet" title="Link to this definition">¶</a></dt>
<dd><p>PyTorch Geometric implementation of SchNet
Code adapted from <a class="reference internal" href="bibliography.html#pt-geom-schnet" id="id1"><span>[PT_geom_schnet]</span></a>  which is based on the architecture
described in <a class="reference internal" href="bibliography.html#schnet" id="id2"><span>[Schnet]</span></a> .</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>embedding_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Initial embedding layer that transforms atoms/coarse grain bead
types into embedded features</p></li>
<li><p><strong>interaction_blocks</strong> (<em>list</em><em> of </em><em>torch.nn.Module</em><em> or </em><em>torch.nn.Sequential</em>) – Sequential interaction blocks of the model, where each interaction
block applies</p></li>
<li><p><strong>rbf_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – The set of radial basis functions that expands pairwise distances
between atoms/CG beads.</p></li>
<li><p><strong>output_network</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Output neural network that predicts scalar energies from SchNet
features. This network should transform (num_examples * num_atoms,
hidden_channels) to (num_examples * num atoms, 1).</p></li>
<li><p><strong>upper_distance_cutoff</strong> – Upper distance cutoff used for making neighbor lists.</p></li>
<li><p><strong>self_interaction</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – If True, self interactions/distancess are calculated. But it never
had a function due to a bug in the implementation (see static method
<cite>neighbor_list</cite>). Should be kept False. This option shall not be
deleted for compatibility.</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Maximum number of neighbors to return for a
given node/atom when constructing the molecular graph during forward
passes. This attribute is passed to the torch_cluster radius_graph
routine keyword max_num_neighbors, which normally defaults to 32.
Users should set this to higher values if they are using higher upper
distance cutoffs and expect more than 32 neighbors per node/atom.</p></li>
<li><p><strong>nls_distance_method</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Method for computing a neighbor list. Supported values are
<cite>torch</cite>, <cite>nvalchemi_naive</cite>, <cite>nvalchemi_cell</cite> and custom.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.schnet.SchNet.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#SchNet.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.SchNet.forward" title="Link to this definition">¶</a></dt>
<dd><p>Forward pass through the SchNet architecture.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtomicData</span></code></a></span>) – Input data object containing batch atom/bead positions
and atom/bead types.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Data dictionary, updated with predicted energy of shape
(num_examples * num_atoms, 1), as well as neighbor list
information.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.schnet.SchNet.neighbor_list">
<span class="sig-name descname"><span class="pre">neighbor_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#SchNet.neighbor_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.SchNet.neighbor_list" title="Link to this definition">¶</a></dt>
<dd><p>Computes the neighborlist for <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code> using a strict cutoff of <code class="xref py py-obj docutils literal notranslate"><span class="pre">rcut</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.schnet.SchNet.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#SchNet.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.SchNet.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method for resetting linear layers in each SchNet component</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.schnet.StandardSchNet">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.schnet.</span></span><span class="sig-name descname"><span class="pre">StandardSchNet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rbf_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_hidden_layer_widths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_filters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_interactions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">Tanh()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'add'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/schnet.html#StandardSchNet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.schnet.StandardSchNet" title="Link to this definition">¶</a></dt>
<dd><p>Small wrapper class for <span class="xref std std-ref">mlcg.nn.SchNet</span> to simplify the definition of the
SchNet model through an input file. The upper distance cutoff attribute
in is set by default to match the upper cutoff value in the cutoff function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rbf_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – radial basis function used to project the distances <span class="math notranslate nohighlight">\(r_{ij}\)</span>.</p></li>
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – smooth cutoff function to supply to the CFConv</p></li>
<li><p><strong>output_hidden_layer_widths</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – List giving the number of hidden nodes of each hidden layer of the MLP
used to predict the target property from the learned representation.</p></li>
<li><p><strong>hidden_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – dimension of the learned representation, i.e. dimension of the embeding projection, convolution layers, and interaction block.</p></li>
<li><p><strong>embedding_size</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – dimension of the input embeddings (should be larger than <code class="xref py py-obj docutils literal notranslate"><span class="pre">AtomicData.atom_types.max()+1</span></code>).</p></li>
<li><p><strong>num_filters</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – number of nodes of the networks used to filter the projected distances</p></li>
<li><p><strong>num_interactions</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – number of interaction blocks</p></li>
<li><p><strong>activation</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – activation function</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – The maximum number of neighbors to return for each atom in <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code>.
If the number of actual neighbors is greater than
<code class="xref py py-obj docutils literal notranslate"><span class="pre">max_num_neighbors</span></code>, returned neighbors are picked randomly.</p></li>
<li><p><strong>aggr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – <p>Aggregation scheme for continuous filter output. For all options,
see <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/notes/create_gnn.html?highlight=MessagePassing#the-messagepassing-base-class">here</a>
for more options.</p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p id="module-mlcg.nn.painn">Code adapted from <a class="reference external" href="https://github.com/atomistic-machine-learning/schnetpack">https://github.com/atomistic-machine-learning/schnetpack</a></p>
<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNN">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.painn.</span></span><span class="sig-name descname"><span class="pre">PaiNN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">embedding_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interaction_blocks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mixing_blocks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rbf_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_network</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNN"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNN" title="Link to this definition">¶</a></dt>
<dd><p>Implementation of PaiNN - polarizable interaction neural network
Code adapted from <a class="reference external" href="https://schnetpack.readthedocs.io/en/latest/api/generated/representation.PaiNN.html">https://schnetpack.readthedocs.io/en/latest/api/generated/representation.PaiNN.html</a>
which is based on the architecture described in <a class="reference external" href="http://proceedings.mlr.press/v139/schutt21a.html">http://proceedings.mlr.press/v139/schutt21a.html</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>embedding_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Initial embedding layer that transforms atoms/coarse grain bead
types into embedded features</p></li>
<li><p><strong>interaction_blocks</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction" title="mlcg.nn.painn.PaiNNInteraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">PaiNNInteraction</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<a class="reference internal" href="#mlcg.nn.painn.PaiNNInteraction" title="mlcg.nn.painn.PaiNNInteraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">PaiNNInteraction</span></code></a>]]</span>) – list of PaiNNInteraction or single PaiNNInteraction block.
Sequential interaction blocks of the model, where each interaction
block applies.</p></li>
<li><p><strong>mixing_blocks</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="#mlcg.nn.painn.PaiNNMixing" title="mlcg.nn.painn.PaiNNMixing"><code class="xref py py-class docutils literal notranslate"><span class="pre">PaiNNMixing</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<a class="reference internal" href="#mlcg.nn.painn.PaiNNMixing" title="mlcg.nn.painn.PaiNNMixing"><code class="xref py py-class docutils literal notranslate"><span class="pre">PaiNNMixing</span></code></a>]]</span>) – List of PaiNNMixing or single PaiNNMixing block.
Sequential mixing blocks of the model, where each mixing
applies after each interaction block.</p></li>
<li><p><strong>rbf_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – The set of radial basis functions that expands pairwise distances
between atoms/CG beads.</p></li>
<li><p><strong>output_network</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Output neural network that predicts scalar energies from scalar PaiNN
features. This network should transform (num_examples * num_atoms,
hidden_channels) to (num_examples * num atoms, 1).</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Maximum number of neighbors to return for a
given node/atom when constructing the molecular graph during forward
passes. This attribute is passed to the torch_cluster radius_graph
routine keyword max_num_neighbors, which normally defaults to 32.
Users should set this to higher values if they are using higher upper
distance cutoffs and expect more than 32 neighbors per node/atom.</p></li>
<li><p><strong>nls_distance_method</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Method for computing a neighbor list. Supported values are
<cite>torch</cite>, <cite>nvalchemi_naive</cite>, <cite>nvalchemi_cell</cite> and custom.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNN.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNN.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNN.forward" title="Link to this definition">¶</a></dt>
<dd><p>Forward pass through the PaiNN architecture.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtomicData</span></code></a></span>) – Input data object containing batch atom/bead positions
and atom/bead types.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Data dictionary, updated with predicted energy of shape
(num_examples * num_atoms, 1), as well as neighbor list
information.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>data</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNN.neighbor_list">
<span class="sig-name descname"><span class="pre">neighbor_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNN.neighbor_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNN.neighbor_list" title="Link to this definition">¶</a></dt>
<dd><p>Computes the neighborlist for <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code> using a strict cutoff of <code class="xref py py-obj docutils literal notranslate"><span class="pre">rcut</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNN.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNN.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNN.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method for resetting linear layers in each PaiNN component</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNInteraction">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.painn.</span></span><span class="sig-name descname"><span class="pre">PaiNNInteraction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hidden_channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_attr_dim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'add'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNInteraction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNInteraction" title="Link to this definition">¶</a></dt>
<dd><p>PyTorch Geometric implementation of PaiNN block for modeling equivariant interactions.
Code adapted from <a class="reference external" href="https://schnetpack.readthedocs.io/en/latest/api/generated/representation.PaiNN.html">https://schnetpack.readthedocs.io/en/latest/api/generated/representation.PaiNN.html</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hidden_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Hidden channel dimension, i.e. node feature size used for the node embedding.</p></li>
<li><p><strong>edge_attr_dim</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Edge attributes dimension, i.e. number of radial basis functions.</p></li>
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Cutoff function</p></li>
<li><p><strong>activation</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></span>) – Activation function applied to linear layer outputs.</p></li>
<li><p><strong>aggr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Aggregation scheme for continuous filter output. For all options,
see <cite>here &lt;https://pytorch-geometric.readthedocs.io/en/latest/notes/create_gnn.html?highlight=MessagePassing#the-messagepassing-base-class&gt;</cite>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNInteraction.aggregate">
<span class="sig-name descname"><span class="pre">aggregate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNInteraction.aggregate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNInteraction.aggregate" title="Link to this definition">¶</a></dt>
<dd><p>Aggregates messages from neighbors as
<span class="math notranslate nohighlight">\(\bigoplus_{j \in \mathcal{N}(i)}\)</span>.</p>
<p>Takes in the output of message computation as first argument and any
argument which was initially passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">propagate()</span></code>.</p>
<p>By default, this function will delegate its call to the underlying
<code class="xref py py-class docutils literal notranslate"><span class="pre">Aggregation</span></code> module to reduce messages
as specified in <code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code> by the <code class="xref py py-obj docutils literal notranslate"><span class="pre">aggr</span></code> argument.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNInteraction.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scalar_node_features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_node_features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_attr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNInteraction.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNInteraction.forward" title="Link to this definition">¶</a></dt>
<dd><p>Compute interaction output.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scalar_node_features</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Scalar input embedding per node with shape (n_nodes, 1, n_feat).</p></li>
<li><p><strong>vector_node_features</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Vector input embedding per node with shape (n_nodes, 3, n_feat).</p></li>
<li><p><strong>normdir</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Normalized directions for every edge with shape (total_num_edges, 3).</p></li>
<li><p><strong>edge_index</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Graph edge index tensor of shape (2, total_num_edges).</p></li>
<li><p><strong>edge_weight</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Scalar edge weight, i.e. distances, of shape (total_num_edges, 1).</p></li>
<li><p><strong>edge_attr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Edge attributes, i.e. rbf projection, of shape (total_num_edges, edge_attr_dim).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>x_scalar</em> – Updated scalar embedding per node with shape (n_nodes, 1, n_feat).</p></li>
<li><p><em>x_vector</em> – Updated vector embedding per node with shape (n_nodes, 3, n_feat).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNInteraction.message">
<span class="sig-name descname"><span class="pre">message</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_vector_j</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">W</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normdir</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNInteraction.message"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNInteraction.message" title="Link to this definition">¶</a></dt>
<dd><p>Message passing operation to generate messages for
scalar and vectorial features.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_j</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of embedded features of shape
(total_num_edges,3*hidden_channels)</p></li>
<li><p><strong>x_vector_j</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of vectorial features of shape
(total_num_edges,3*hidden_channels)</p></li>
<li><p><strong>W</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of filter values of shape
(total_num_edges, 3*hidden_channels)</p></li>
<li><p><strong>normdir</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of distances versors of shape
(total_num_edges, 3)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>dq</em> – Scalar updates for all nodes.</p></li>
<li><p><em>dmu</em> – Vectorial updates for all nodes</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNInteraction.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNInteraction.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNInteraction.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method for resetting the weights of the linear
layers and filter network according the the
Xavier uniform strategy. Biases
are set to 0.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNInteraction.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_scalar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_vector</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNInteraction.update"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNInteraction.update" title="Link to this definition">¶</a></dt>
<dd><p>Updates node embeddings in analogy to
<span class="math notranslate nohighlight">\(\gamma_{\mathbf{\Theta}}\)</span> for each node
<span class="math notranslate nohighlight">\(i \in \mathcal{V}\)</span>.
Takes in the output of aggregation as first argument and any argument
which was initially passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">propagate()</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNMixing">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.painn.</span></span><span class="sig-name descname"><span class="pre">PaiNNMixing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hidden_channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-08</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNMixing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNMixing" title="Link to this definition">¶</a></dt>
<dd><p>PaiNN interaction block for mixing on scalar and vectorial atom features.
Code adapted from <a class="reference external" href="https://schnetpack.readthedocs.io/en/latest/api/generated/representation.PaiNN.html">https://schnetpack.readthedocs.io/en/latest/api/generated/representation.PaiNN.html</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hidden_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Hidden channel dimension, i.e. node feature size used for the node embedding.</p></li>
<li><p><strong>activation</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></span>) – Activation function applied to linear layer outputs.</p></li>
<li><p><strong>epsilon</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – Stability constant added in norm to prevent numerical instabilities.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNMixing.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scalar_node_features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_node_features</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNMixing.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNMixing.forward" title="Link to this definition">¶</a></dt>
<dd><p>Compute intraatomic mixing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scalar_node_features</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of scalar features of shape (n_nodes, 1, n_feat).</p></li>
<li><p><strong>vector_node_features</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Tensor of vectorial features of shape (n_nodes, 3, n_feat).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>scalar_node_features</em> – Updated tensor of scalar features, mixed with vectorial features.</p></li>
<li><p><em>vector_node_features</em> – Updated tensor of vectorial features, mixed with scalar features.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.painn.PaiNNMixing.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#PaiNNMixing.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.PaiNNMixing.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method for resetting the weights of the linear
layers and filter network according the the
Xavier uniform strategy. Biases
are set to 0.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.painn.StandardPaiNN">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.painn.</span></span><span class="sig-name descname"><span class="pre">StandardPaiNN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rbf_layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_hidden_layer_widths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_channels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_interactions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">Tanh()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'add'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-08</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/painn.html#StandardPaiNN"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.painn.StandardPaiNN" title="Link to this definition">¶</a></dt>
<dd><p>Small wrapper class for <span class="xref std std-ref">PaiNN</span> to simplify the definition of the
PaiNN model through an input file. The upper distance cutoff attribute
in is set by default to match the upper cutoff value in the cutoff function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rbf_layer</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Radial basis function used to project the distances <span class="math notranslate nohighlight">\(r_{ij}\)</span>.</p></li>
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Smooth cutoff function to supply to the PaiNNInteraction.</p></li>
<li><p><strong>output_hidden_layer_widths</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – List giving the number of hidden nodes of each hidden layer of the MLP
used to predict the target property from the learned scalar representation.</p></li>
<li><p><strong>hidden_channels</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Dimension of the learned representation, i.e. dimension of the embedding projection, convolution layers, and interaction block.</p></li>
<li><p><strong>embedding_size</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Dimension of the input embeddings (should be larger than <code class="xref py py-obj docutils literal notranslate"><span class="pre">AtomicData.atom_types.max()+1</span></code>).</p></li>
<li><p><strong>num_interactions</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Number of interaction blocks.</p></li>
<li><p><strong>activation</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></span>) – Activation function.</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – The maximum number of neighbors to return for each atom in <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code>.
If the number of actual neighbors is greater than
<code class="xref py py-obj docutils literal notranslate"><span class="pre">max_num_neighbors</span></code>, returned neighbors are picked randomly.</p></li>
<li><p><strong>aggr</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – <p>Aggregation scheme for continuous filter output. For all options,
see <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/notes/create_gnn.html?highlight=MessagePassing#the-messagepassing-base-class">here</a>
for more options.</p>
</p></li>
<li><p><strong>epsilon</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – Stability constant added in norm to prevent numerical instabilities.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class" id="module-mlcg.nn.mace">
<dt class="sig sig-object py" id="mlcg.nn.mace.CustomRealAgnosticResidualInteractionBlock">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.mace.</span></span><span class="sig-name descname"><span class="pre">CustomRealAgnosticResidualInteractionBlock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_attrs_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_feats_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_attrs_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_feats_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avg_num_neighbors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radial_MLP</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cueq_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/mace.html#CustomRealAgnosticResidualInteractionBlock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.mace.CustomRealAgnosticResidualInteractionBlock" title="Link to this definition">¶</a></dt>
<dd><p>version of the mace.modules.blocks RealAgnosticResidualInteractionBlock
without a hardcoded tanh gate.</p>
<p>We avoid doing a general AgnosticResidualInteractionBlock as it would require
a larger rewritting of our MACE implementation</p>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.mace.CustomRealAgnosticResidualInteractionBlock.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_attrs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_feats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_attrs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_feats</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lammps_class</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lammps_natoms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/mace.html#CustomRealAgnosticResidualInteractionBlock.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.mace.CustomRealAgnosticResidualInteractionBlock.forward" title="Link to this definition">¶</a></dt>
<dd><p>Define the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.mace.MACE">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.mace.</span></span><span class="sig-name descname"><span class="pre">MACE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atomic_numbers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_embedding</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radial_embedding</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spherical_harmonics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interactions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">products</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">readouts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pair_repulsion_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/mace.html#MACE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.mace.MACE" title="Link to this definition">¶</a></dt>
<dd><p>Implementation of MACE neural network model from <a class="reference external" href="https://github.com/ACEsuit/mace">https://github.com/ACEsuit/mace</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>atomic_numbers</strong> (<em>torch.Tensor</em>) – Tensor of atomic numbers present in the system.</p></li>
<li><p><strong>node_embedding</strong> (<em>torch.nn.Module</em>) – Module for embedding node (atom) attributes.</p></li>
<li><p><strong>radial_embedding</strong> (<em>torch.nn.Module</em>) – Module for embedding radial (distance) features.</p></li>
<li><p><strong>spherical_harmonics</strong> (<em>torch.nn.Module</em>) – Module for computing spherical harmonics of edge vectors.</p></li>
<li><p><strong>interactions</strong> (<em>List</em><em>[</em><em>torch.nn.Module</em><em>]</em>) – List of interaction blocks.</p></li>
<li><p><strong>products</strong> (<em>List</em><em>[</em><em>torch.nn.Module</em><em>]</em>) – List of product basis blocks.</p></li>
<li><p><strong>readouts</strong> (<em>List</em><em>[</em><em>torch.nn.Module</em><em>]</em>) – List of readout blocks.</p></li>
<li><p><strong>r_max</strong> (<em>float</em>) – Cutoff radius for neighbor list.</p></li>
<li><p><strong>max_num_neighbors</strong> (<em>int</em>) – Maximum number of neighbors per atom.</p></li>
<li><p><strong>pair_repulsion_fn</strong> (<em>torch.nn.Module</em><em>, </em><em>optional</em>) – Optional pairwise repulsion energy function.</p></li>
<li><p><strong>nls_distance_method</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Method for computing a neighbor list. Supported values are
<cite>torch</cite>, <cite>nvalchemi_naive</cite>, <cite>nvalchemi_cell</cite> and custom.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.mace.MACE.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/mace.html#MACE.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.mace.MACE.forward" title="Link to this definition">¶</a></dt>
<dd><p>Forward pass of the MACE model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData"><em>AtomicData</em></a>) – Input atomic data object.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output data with predicted energies in <cite>data.out</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData">AtomicData</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.mace.MACE.neighbor_list">
<span class="sig-name descname"><span class="pre">neighbor_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/mace.html#MACE.neighbor_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.mace.MACE.neighbor_list" title="Link to this definition">¶</a></dt>
<dd><p>Computes the neighborlist for <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code> using a strict cutoff of <code class="xref py py-obj docutils literal notranslate"><span class="pre">rcut</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></span></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.mace.StandardMACE">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.mace.</span></span><span class="sig-name descname"><span class="pre">StandardMACE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bessel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_polynomial_cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_ell</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interaction_cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interaction_cls_first</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_interactions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MLP_irreps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avg_num_neighbors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atomic_numbers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correlation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pair_repulsion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'None'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radial_MLP</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radial_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'bessel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cueq_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_cueq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/mace.html#StandardMACE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.mace.StandardMACE" title="Link to this definition">¶</a></dt>
<dd><p>Standard configuration of the MACE model.</p>
<p>This class provides a convenient interface for constructing a MACE model
with typical settings and block choices, including embedding, interaction,
and readout modules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r_max</strong> (<em>float</em>) – Cutoff radius for neighbor list.</p></li>
<li><p><strong>num_bessel</strong> (<em>int</em>) – Number of Bessel functions for radial basis.</p></li>
<li><p><strong>num_polynomial_cutoff</strong> (<em>int</em>) – Number of polynomial cutoff functions.</p></li>
<li><p><strong>max_ell</strong> (<em>int</em>) – Maximum angular momentum for spherical harmonics.</p></li>
<li><p><strong>interaction_cls</strong> (<em>str</em>) – Class name for interaction blocks.</p></li>
<li><p><strong>interaction_cls_first</strong> (<em>str</em>) – Class name for the first interaction block.</p></li>
<li><p><strong>num_interactions</strong> (<em>int</em>) – Number of interaction blocks.</p></li>
<li><p><strong>hidden_irreps</strong> (<em>str</em>) – Irreducible representations for hidden features. For example if only
a scalar representation with 128 channels is used can be “128x0e”. If
also a vector representation is used can be “128x0e + 128x1o”.</p></li>
<li><p><strong>MLP_irreps</strong> (<em>str</em>) – Irreducible representations for MLP layers.</p></li>
<li><p><strong>avg_num_neighbors</strong> (<em>float</em>) – Average number of neighbors per atom used for normalization and numerical stability.</p></li>
<li><p><strong>atomic_numbers</strong> (<em>List</em><em>[</em><em>int</em><em>]</em>) – List of atomic numbers in the system.</p></li>
<li><p><strong>correlation</strong> (<em>Union</em><em>[</em><em>int</em><em>, </em><em>List</em><em>[</em><em>int</em><em>]</em><em>]</em>) – Correlation order(s) for product blocks.</p></li>
<li><p><strong>gate</strong> (<em>Optional</em><em>[</em><em>Callable</em><em>]</em>) – Activation function for non-linearities.</p></li>
<li><p><strong>max_num_neighbors</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of neighbors per atom.</p></li>
<li><p><strong>pair_repulsion</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to use pairwise repulsion.</p></li>
<li><p><strong>distance_transform</strong> (<em>str</em><em>, </em><em>optional</em>) – Distance transformation type.</p></li>
<li><p><strong>radial_MLP</strong> (<em>Optional</em><em>[</em><em>List</em><em>[</em><em>int</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – Radial MLP architecture.</p></li>
<li><p><strong>radial_type</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – Radial basis type.</p></li>
<li><p><strong>cueq_config</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – cuEquivariance configuration.</p></li>
<li><p><strong>use_cueq</strong> (<em>Optional</em><em>[</em><em>bool</em><em>]</em><em>, </em><em>optional</em>) – Whether to use cuEquivariance acceleration.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-mlcg.nn.radial_basis.radial_integral_gto">
<span id="radial-basis-functions"></span><h2>Radial basis functions<a class="headerlink" href="#module-mlcg.nn.radial_basis.radial_integral_gto" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.radial_basis.radial_integral_gto.</span></span><span class="sig-name descname"><span class="pre">RIGTOBasis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mesh_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/radial_integral_gto.html#RIGTOBasis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis" title="Link to this definition">¶</a></dt>
<dd><p>This radial basis is the effective basis when expanding an atomic
density smeared by Gaussains of width <span class="math notranslate nohighlight">\(\sigma\)</span> on a set of
<span class="math notranslate nohighlight">\(n_{max}\)</span> orthonormal Gaussian Type Orbitals (GTOs) and
<span class="math notranslate nohighlight">\(l_{max}+1\)</span> Spherical Harmonics (SPHs) namely.
This radial basis set is interpolated using natural cubic splines for
efficiency and the cutoff is included into the splined functions.</p>
<p>The basis is defined as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[R_{nl}(r) = f_c(r) \mathcal{N}_n \frac{\Gamma(\frac{n+l+3}{2})}{\Gamma(l+\frac{3}{2})}
c^l r^l(c+b_n)^{-\frac{(n+l+3)}{2}}
{}_1F_1\left(\frac{n+l+3}{2},l+\frac{3}{2};\frac{c^2 r^2}{c+b_n}\right),\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\({}_1F_1\)</span> is the confluent hypergeometric function,
<span class="math notranslate nohighlight">\(\Gamma\)</span> is the gamma function, <span class="math notranslate nohighlight">\(f_c\)</span> is a cutoff function,
<span class="math notranslate nohighlight">\(b_n=\frac{1}{2\sigma_n^2}\)</span>, <span class="math notranslate nohighlight">\(c= 1 / (2\sigma^2\)</span>,
<span class="math notranslate nohighlight">\(\sigma_n = r_\text{cut} \max(\sqrt{n},1)/n_{max}\)</span> and
<span class="math notranslate nohighlight">\(\mathcal{N}_n^2 = \frac{2}{\sigma_n^{2n + 3}\Gamma(n + 3/2)}\)</span>.</p>
<p>For more details on the derivation, refer to <a class="reference external" href="https://doi.org/10.5075/epfl-thesis-7997">appendix A</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nmax</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – number of radial basis</p></li>
<li><p><strong>lmax</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – maximum spherical order (lmax included so there are lmax+1 orders)</p></li>
<li><p><strong>sigma</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – smearing of the atomic density</p></li>
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">_Cutoff</span></code>]</span>) – Defines the smooth cutoff function. If a float is provided, it will be
interpreted as an upper cutoff and a CosineCutoff will be used between
0 and the provided float. Otherwise, a chosen _Cutoff instance can be
supplied.</p></li>
<li><p><strong>mesh_size</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – number of points used to interpolate with splines the radial basis spanning uniformly the range difined by the cutoff <span class="math notranslate nohighlight">\([0, r_c]\)</span>.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/radial_integral_gto.html#RIGTOBasis.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis.forward" title="Link to this definition">¶</a></dt>
<dd><p>Expansion of distances through the radial basis function set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dist</strong> (<em>torch.Tensor</em>) – Input pairwise distances of shape (total_num_edges)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>expanded_distances</strong> – Distances expanded in the radial basis with shape (total_num_edges, lmax + 1, nmax)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis.plot">
<span class="sig-name descname"><span class="pre">plot</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/radial_integral_gto.html#RIGTOBasis.plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.radial_integral_gto.RIGTOBasis.plot" title="Link to this definition">¶</a></dt>
<dd><p>Plot the set of radial basis function.</p>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-mlcg.nn.radial_basis.exp_normal">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_normal.ExpNormalBasis">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.radial_basis.exp_normal.</span></span><span class="sig-name descname"><span class="pre">ExpNormalBasis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_rbf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_normal.html#ExpNormalBasis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_normal.ExpNormalBasis" title="Link to this definition">¶</a></dt>
<dd><p>Class for generating a set of exponential normal radial basis functions,
as described in <a class="reference internal" href="bibliography.html#physnet" id="id5"><span>[Physnet]</span></a> . The functions have the following form:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_n(r_{ij};\alpha, r_{low},r_{high}) = f_{cut}(r_{ij},r_{low},r_{high})
\times \exp\left[-\beta_n \left(e^{\alpha (r_{ij} -r_{high}) }
- \mu_n \right)^2\right]\]</div>
</div>
<p>where</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\alpha = 5.0/(r_{high} - r_{low})\]</div>
</div>
<p>is a distance rescaling factor, and, by default</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_{cut} ( r_{ij},r_{low},r_{high} ) =  \cos{\left( r_{ij} \times \pi / r_{high}\right)} + 1.0\]</div>
</div>
<p>represents a cosine cutoff function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">_Cutoff</span></code>]</span>) – Defines the smooth cutoff function. If a float is provided, it will be interpreted as
an upper cutoff and a CosineCutoff will be used between 0 and the provided float. Otherwise,
a chosen <cite>_Cutoff</cite> instance can be supplied.</p></li>
<li><p><strong>num_rbf</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – The number of functions in the basis set.</p></li>
<li><p><strong>trainable</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – If True, the parameters of the basis (the centers and widths of each
function) are registered as optimizable parameters that will be updated
during backpropagation. If False, these parameters will be instead fixed
in an unoptimizable buffer.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_normal.ExpNormalBasis.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_normal.html#ExpNormalBasis.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_normal.ExpNormalBasis.forward" title="Link to this definition">¶</a></dt>
<dd><p>Expansion of distances through the radial basis function set.
:type dist: <span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>
:param dist: Input pairwise distances of shape (total_num_edges)
:type dist: torch.Tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>expanded_distances</strong> – Distances expanded in the radial basis with shape (total_num_edges, num_rbf)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_normal.ExpNormalBasis.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_normal.html#ExpNormalBasis.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_normal.ExpNormalBasis.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method to reset the parameters of the basis functions to their
initial values.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.radial_basis.exp_normal.</span></span><span class="sig-name descname"><span class="pre">ExtendedExpNormalBasis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">internal_cutoff_lower</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_normal.html#ExtendedExpNormalBasis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis" title="Link to this definition">¶</a></dt>
<dd><p>ExpNormalBasis that allows for arbitrary lower cutoffs not tied to
a supplied <cite>_Cutoff</cite>. This basis follows the definition in <a class="reference internal" href="bibliography.html#physnet" id="id6"><span>[Physnet]</span></a>.
:param internal_cutoff: if specified, this lower cutoff overrides any supplied <cite>_Cutoff</cite> lower</p>
<blockquote>
<div><p>cutoff.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>trainable</strong> – If True, the parameters of the basis (the centers and widths of each
function) are registered as optimizable parameters that will be updated
during backpropagation. If False, these parameters will be instead fixed
in an unoptimizable buffer.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis.extended_initial_params">
<span class="sig-name descname"><span class="pre">extended_initial_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_normal.html#ExtendedExpNormalBasis.extended_initial_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis.extended_initial_params" title="Link to this definition">¶</a></dt>
<dd><p>Method for initializing the basis function parameters, as described in
<a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.9b00181">https://pubs.acs.org/doi/10.1021/acs.jctc.9b00181</a> .</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_normal.html#ExtendedExpNormalBasis.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_normal.ExtendedExpNormalBasis.forward" title="Link to this definition">¶</a></dt>
<dd><p>Expansion of distances through the radial basis function set.
:type dist: <span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>
:param dist: Input pairwise distances of shape (total_num_edges)
:type dist: torch.Tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>expanded_distances</strong> – Distances expanded in the radial basis with shape (total_num_edges, num_rbf)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-mlcg.nn.radial_basis.gaussian">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.gaussian.GaussianBasis">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.radial_basis.gaussian.</span></span><span class="sig-name descname"><span class="pre">GaussianBasis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_rbf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/gaussian.html#GaussianBasis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.gaussian.GaussianBasis" title="Link to this definition">¶</a></dt>
<dd><p>Class that generates a set of equidistant 1-D gaussian basis functions
scattered between a specified lower and upper cutoff:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_n = \exp{ \left( -\gamma(r-c_n)^2 \right) }\]</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">_Cutoff</span></code>]</span>) – Defines the smooth cutoff function. If a float is provided, it will be interpreted as
an upper cutoff and an IdentityCutoff will be used between 0 and the provided float. Otherwise,
a chosen _Cutoff instance can be supplied.</p></li>
<li><p><strong>num_rbf</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – The number of gaussian functions in the basis set.</p></li>
<li><p><strong>trainable</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – If True, the parameters of the gaussian basis (the centers and widths of
each function) are registered as optimizable parameters that will be
updated during backpropagation. If False, these parameters will be
instead fixed in an unoptimizable buffer.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.gaussian.GaussianBasis.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/gaussian.html#GaussianBasis.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.gaussian.GaussianBasis.forward" title="Link to this definition">¶</a></dt>
<dd><p>Expansion of distances through the radial basis function set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dist</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Input pairwise distances of shape (total_num_edges)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Distances expanded in the radial basis with shape (total_num_edges,
num_rbf)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>expanded_distances</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.gaussian.GaussianBasis.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/gaussian.html#GaussianBasis.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.gaussian.GaussianBasis.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method for resetting the basis to its initial state</p>
</dd></dl>

</dd></dl>

<dl class="py class" id="module-mlcg.nn.radial_basis.exp_spaced">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.radial_basis.exp_spaced.</span></span><span class="sig-name descname"><span class="pre">SpacedExpBasis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_spacing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trainable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_spaced.html#SpacedExpBasis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis" title="Link to this definition">¶</a></dt>
<dd><p>Class for generating a set of exponential normal radial basis functions,
with means and standard deviations designed to capture the physics around 2 <span class="math notranslate nohighlight">\(\AA\)</span>.
The functions have an exponential form with the following means and std:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}&amp;\mu_0 = 0                       &amp;,\quad &amp;\sigma_0 = \sigma_f/s \\
&amp;\mu_1 = \sigma_f                &amp;,\quad &amp;\sigma_1 = \sigma_{min} \\
&amp;\mu_2 = \mu_1 + s\,\sigma_1     &amp;,\quad &amp;\sigma_2 = \sigma_f \sigma_1 \\
&amp;\vdots &amp;\vdots      \;         &amp;\vdots \\
&amp;\mu_n = \mu_{n-1} + s\,\sigma_{n-1} &amp;,\quad &amp;\sigma_n = \sigma_f \sigma_{n-1}\end{split}\]</div>
</div>
<p>with <span class="math notranslate nohighlight">\(\sigma_{min}\)</span> the minimum sigma,  <span class="math notranslate nohighlight">\(\sigma_f\)</span> the sigma factor and
<span class="math notranslate nohighlight">\(s\)</span> the mean spacing</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">_Cutoff</span></code>]</span>) – Defines the smooth cutoff function. If a float is provided, it will be interpreted as
an IdentityCutoff ranging over [0, cutoff]. Otherwise,
a chosen <cite>_Cutoff</cite> instance can be supplied.</p></li>
<li><p><strong>sigma_min</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – <span class="math notranslate nohighlight">\(\sigma_{min}\)</span>, width of first non-zero-centered basis function</p></li>
<li><p><strong>sigma_factor</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – <span class="math notranslate nohighlight">\(\sigma_f\)</span>, location of first non-zero-centered basis function and multiplicative factor to spread std of each new peak by</p></li>
<li><p><strong>mean_spacing</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – <span class="math notranslate nohighlight">\(s\)</span> this time previous sigma indicates how much to distance the mean of subsequent gaussian by</p></li>
<li><p><strong>trainable</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – If True, the parameters of the basis (the centers and widths of each
function) are registered as optimizable parameters that will be updated
during backpropagation. If False, these parameters will be instead fixed
in an unoptimizable buffer.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_spaced.html#SpacedExpBasis.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis.forward" title="Link to this definition">¶</a></dt>
<dd><p>Expansion of distances through the radial basis function set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dist</strong> (<em>torch.Tensor</em>) – Input pairwise distances of shape (total_num_edges)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>expanded_distances</strong> – Distances expanded in the radial basis with shape (total_num_edges, num_rbf)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis.reset_parameters">
<span class="sig-name descname"><span class="pre">reset_parameters</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/radial_basis/exp_spaced.html#SpacedExpBasis.reset_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.radial_basis.exp_spaced.SpacedExpBasis.reset_parameters" title="Link to this definition">¶</a></dt>
<dd><p>Method to reset the parameters of the basis functions to their
initial values.</p>
</dd></dl>

</dd></dl>

<p id="module-mlcg.nn.angular_basis.spherical_harmonics">Spherical Harmonics as polynomials of x, y, z
taken from the e3nn repo changing the layout of the output sph
(<a class="reference external" href="https://github.com/e3nn/e3nn/tree/34ebae91b094392a9f26dfa153f9350d0e24d185">https://github.com/e3nn/e3nn/tree/34ebae91b094392a9f26dfa153f9350d0e24d185</a>)</p>
<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.angular_basis.spherical_harmonics.SphericalHarmonics">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.angular_basis.spherical_harmonics.</span></span><span class="sig-name descname"><span class="pre">SphericalHarmonics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lmax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'integral'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irreps_in</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/angular_basis/spherical_harmonics.html#SphericalHarmonics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.angular_basis.spherical_harmonics.SphericalHarmonics" title="Link to this definition">¶</a></dt>
<dd><p>JITable module version of real Spherical harmonics</p>
<img alt="https://user-images.githubusercontent.com/333780/79220728-dbe82c00-7e54-11ea-82c7-b3acbd9b2246.gif" src="https://user-images.githubusercontent.com/333780/79220728-dbe82c00-7e54-11ea-82c7-b3acbd9b2246.gif" />
<div class="line-block">
<div class="line">Polynomials defined on the 3d space <span class="math notranslate nohighlight">\(Y^l: \mathbb{R}^3 \longrightarrow \mathbb{R}^{2l+1}\)</span></div>
<div class="line">Usually restricted on the sphere (with <code class="docutils literal notranslate"><span class="pre">normalize=True</span></code>) <span class="math notranslate nohighlight">\(Y^l: S^2 \longrightarrow \mathbb{R}^{2l+1}\)</span></div>
<div class="line">who satisfies the following properties:</div>
</div>
<ul class="simple">
<li><p>are polynomials of the cartesian coordinates <code class="docutils literal notranslate"><span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z</span></code></p></li>
<li><p>is equivariant <span class="math notranslate nohighlight">\(Y^l(R x) = D^l(R) Y^l(x)\)</span></p></li>
<li><p>are orthogonal <span class="math notranslate nohighlight">\(\int_{S^2} Y^l_m(x) Y^j_n(x) dx = \text{cste} \; \delta_{lj} \delta_{mn}\)</span></p></li>
</ul>
<p>The value of the constant depends on the choice of normalization.</p>
<p>It obeys the following property:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}Y^{l+1}_i(x) &amp;= \text{cste}(l) \; &amp; C_{ijk} Y^l_j(x) x_k\\\partial_k Y^{l+1}_i(x) &amp;= \text{cste}(l) \; (l+1) &amp; C_{ijk} Y^l_j(x)\end{aligned}\end{align} \]</div>
</div>
<p>Where <span class="math notranslate nohighlight">\(C\)</span> are the <a class="reference external" href="https://en.wikipedia.org/wiki/3-j_symbol">Wigner 3-j symbols</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function matches with the following table of standard real spherical harmonics from <a class="reference external" href="https://en.wikipedia.org/wiki/Table_of_spherical_harmonics#Real_spherical_harmonics">Wikipedia</a>
when <code class="docutils literal notranslate"><span class="pre">normalize=True</span></code>, <code class="docutils literal notranslate"><span class="pre">normalization='integral'</span></code> and is called with the argument in the order <code class="docutils literal notranslate"><span class="pre">y,z,x</span></code> (instead of <code class="docutils literal notranslate"><span class="pre">x,y,z</span></code>).</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l</strong> (<em>int</em><em> or </em><em>list</em><em> of </em><em>int</em>) – degree of the spherical harmonics.</p></li>
<li><p><strong>x</strong> (<cite>torch.Tensor</cite>) – tensor <span class="math notranslate nohighlight">\(x\)</span> of shape <code class="docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">3)</span></code>.</p></li>
<li><p><strong>normalize</strong> (<em>bool</em>) – whether to normalize the <code class="docutils literal notranslate"><span class="pre">x</span></code> to vectors that lie on the unit sphere before projecting onto the spherical harmonics</p></li>
<li><p><strong>normalization</strong> (<em>{'integral'</em><em>, </em><em>'component'</em><em>, </em><em>'norm'}</em>) – normalization of the output tensors — note that this option is independent of <code class="docutils literal notranslate"><span class="pre">normalize</span></code>, which controls the processing of the <em>input</em>, rather than the output.
Valid options:
* <em>component</em>: <span class="math notranslate nohighlight">\(\|Y^l(x)\|^2 = 2l+1, x \in S^2\)</span>
* <em>norm</em>: <span class="math notranslate nohighlight">\(\|Y^l(x)\| = 1, x \in S^2\)</span>, <code class="docutils literal notranslate"><span class="pre">component</span> <span class="pre">/</span> <span class="pre">sqrt(2l+1)</span></code>
* <em>integral</em>: <span class="math notranslate nohighlight">\(\int_{S^2} Y^l_m(x)^2 dx = 1\)</span>, <code class="docutils literal notranslate"><span class="pre">component</span> <span class="pre">/</span> <span class="pre">sqrt(4pi)</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>a list of tensors of shapes <code class="docutils literal notranslate"><span class="pre">[lmax][n_neighbor,</span> <span class="pre">m]</span></code> where <span class="math notranslate nohighlight">\(m&lt;=l\)</span></p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[Y^l(x)\]</div>
</div>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>List[torch.Tensor]</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.angular_basis.spherical_harmonics.SphericalHarmonics.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/angular_basis/spherical_harmonics.html#SphericalHarmonics.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.angular_basis.spherical_harmonics.SphericalHarmonics.forward" title="Link to this definition">¶</a></dt>
<dd><p>Define the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the recipe for forward pass needs to be defined within
this function, one should call the <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> instance afterwards
instead of this since the former takes care of running the
registered hooks while the latter silently ignores them.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-mlcg.nn.cutoff">
<span id="cutoff-functions"></span><h2>Cutoff functions<a class="headerlink" href="#module-mlcg.nn.cutoff" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.cutoff.CosineCutoff">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.cutoff.</span></span><span class="sig-name descname"><span class="pre">CosineCutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cutoff_lower</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff_upper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/cutoff.html#CosineCutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.cutoff.CosineCutoff" title="Link to this definition">¶</a></dt>
<dd><p>Class implementing a cutoff envelope based a cosine signal in the
interval <cite>[lower_cutoff, upper_cutoff]</cite>:</p>
<p>When the lower cutoff is set to 0, the function takes the form:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\cos{\left( r_{ij} \times \pi / r_{high}\right)} + 1.0\]</div>
</div>
<p>For higher than zero values of the lower cutoff, the function takes
the form</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[0.5 \cos{ \left[ \pi \left(2 \frac{r_{ij} - r_{low}}{r_{high}
 - r_{low}} + 1.0 \right)\right]} + 0.5\]</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The behavior of the cutoff is qualitatively different for lower
cutoff values greater than zero when compared to the zero lower cutoff
default. We recommend visualizing your basis via the <cite>plot</cite> method.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.cutoff.CosineCutoff.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distances</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/cutoff.html#CosineCutoff.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.cutoff.CosineCutoff.forward" title="Link to this definition">¶</a></dt>
<dd><p>Applies cutoff envelope to distances.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>distances</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Distances of shape (total_num_edges)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Distances multiplied by the cutoff envelope, with shape
(total_num_edges)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>cutoffs</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.cutoff.IdentityCutoff">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.cutoff.</span></span><span class="sig-name descname"><span class="pre">IdentityCutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cutoff_lower</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff_upper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/cutoff.html#IdentityCutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.cutoff.IdentityCutoff" title="Link to this definition">¶</a></dt>
<dd><p>Cutoff function that is one everywhere, but retains
cutoff_lower and cutoff_upper attributes</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cutoff_lower</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – left bound for the radial cutoff distance</p></li>
<li><p><strong>cutoff_upper</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – right bound for the radial cutoff distance</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.cutoff.IdentityCutoff.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distances</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/cutoff.html#IdentityCutoff.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.cutoff.IdentityCutoff.forward" title="Link to this definition">¶</a></dt>
<dd><p>Fowrad method that returns a cutoff enevlope where all values are
one</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>distances</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – Input distances of shape (total_num_distances)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Cutoff envelope filled with ones, of shape (total_num_edges)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.nn.cutoff.ShiftedCosineCutoff">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.nn.cutoff.</span></span><span class="sig-name descname"><span class="pre">ShiftedCosineCutoff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cutoff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smooth_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/cutoff.html#ShiftedCosineCutoff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.cutoff.ShiftedCosineCutoff" title="Link to this definition">¶</a></dt>
<dd><p>Class of Behler cosine cutoff with an additional smoothing parameter.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[0.5 + 0.5  \cos{ \left[ \pi \left( \frac{r_{ij} - r_{high} +
\sigma}{\sigma}\right)\right]}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(\sigma\)</span> is the smoothing width.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cutoff</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</span>) – cutoff radius</p></li>
<li><p><strong>smooth_width</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</span>) – parameter that controls the extent of smoothing in the cutoff envelope.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.nn.cutoff.ShiftedCosineCutoff.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distances</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/nn/cutoff.html#ShiftedCosineCutoff.forward"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.nn.cutoff.ShiftedCosineCutoff.forward" title="Link to this definition">¶</a></dt>
<dd><p>Compute cutoff function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>distances</strong> (<em>torch.Tensor</em>) – values of interatomic distances.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>values of cutoff function.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-mlcg.datasets.chignolin">
<span id="datasets"></span><h2>Datasets<a class="headerlink" href="#module-mlcg.datasets.chignolin" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDataset">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.chignolin.</span></span><span class="sig-name descname"><span class="pre">ChignolinDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'slice_aggregate'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">terminal_embeds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/chignolin.html#ChignolinDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDataset" title="Link to this definition">¶</a></dt>
<dd><p>Dataset for training a CG model of the chignolin protein following a Cα CG mapping using the all-atom data from <a class="reference internal" href="bibliography.html#cgnet" id="id7"><span>[CGnet]</span></a>.</p>
<p>This Dataset produces delta forces for model training, in which the CG prior forces (harmonic bonds and angles and a repulsive term) have been subtracted from the full CG forces.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDataset.download">
<span class="sig-name descname"><span class="pre">download</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/chignolin.html#ChignolinDataset.download"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDataset.download" title="Link to this definition">¶</a></dt>
<dd><p>Downloads the dataset to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.raw_dir</span></code> folder.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDataset.kB">
<span class="sig-name descname"><span class="pre">kB</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.0019872041</span></span><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDataset.kB" title="Link to this definition">¶</a></dt>
<dd><p>Boltzmann constan in kcal/mol/K</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDataset.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/chignolin.html#ChignolinDataset.process"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDataset.process" title="Link to this definition">¶</a></dt>
<dd><p>Processes the dataset to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.processed_dir</span></code> folder.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDataset.processed_file_names">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">processed_file_names</span></span><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDataset.processed_file_names" title="Link to this definition">¶</a></dt>
<dd><p>The name of the files in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.processed_dir</span></code> folder that
must be present in order to skip processing.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDataset.raw_file_names">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">raw_file_names</span></span><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDataset.raw_file_names" title="Link to this definition">¶</a></dt>
<dd><p>The name of the files in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.raw_dir</span></code> folder that must
be present in order to skip downloading.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDataset.temperature">
<span class="sig-name descname"><span class="pre">temperature</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">350</span></span><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDataset.temperature" title="Link to this definition">¶</a></dt>
<dd><p>Temperature used to generate the underlying all-atom data in [K]</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.chignolin.ChignolinDatasetWithDihedralPriors">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.chignolin.</span></span><span class="sig-name descname"><span class="pre">ChignolinDatasetWithDihedralPriors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/chignolin.html#ChignolinDatasetWithDihedralPriors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.chignolin.ChignolinDatasetWithDihedralPriors" title="Link to this definition">¶</a></dt>
<dd><p>Inherit from Chignolin Dataset and redefine priors to compute
Modify _prior_cls to include priors to compute
Must provide</p>
<blockquote>
<div></div></blockquote>
</dd></dl>

<dl class="py class" id="module-mlcg.datasets.alanine_dipeptide">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.alanine_dipeptide.</span></span><span class="sig-name descname"><span class="pre">AlanineDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">root</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset" title="Link to this definition">¶</a></dt>
<dd><p>Dataset for training a CG model of the alanine-dipeptide protein following a Cα + 1 Cbeta CG mapping</p>
<p>Alanine Dipeptide CG structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">        <span class="n">CB</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="2">          <span class="o">|</span>
</span><span data-line="3">  <span class="n">N</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">CA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">C</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span data-line="4"> <span class="o">/</span>                  \
</span><span data-line="5"><span class="n">C</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                 <span class="n">N</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></pre></div>
</div>
<p>This Dataset produces delta forces for model training, in which the CG prior forces (harmonic bonds and angles) have been subtracted from the full CG forces.</p>
<dl class="simple">
<dt>The class works as follows:</dt><dd><ul class="simple">
<li><p>If the raw data (coordinates, forces, and pdb file) for alanine dipeptide does not exist, the files will automatically be downloaded and processed</p></li>
<li><p>If the raw data exists, “root/processed/” will be created and the raw dataset will be processed</p></li>
<li><dl class="simple">
<dt>If the raw data and processed data exists, the class will load the processed dataset containing:</dt><dd><ul>
<li><p>data : AtomicData object containing all the CG positions, forces, embeddings</p></li>
<li><p>slices : Slices of the AtomicData object</p></li>
<li><p>prior_models : Prior models (HarmonicBonds, HarmonicAngles) of the dataset with x_0 and sigma</p></li>
<li><p>topologies : Object of Topology class containing all topology information of the _CG_ molecule, including neighbor lists for bond and angle priors</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>root :</dt><dd><p>Location for AlanineDataset to be downloaded and processed</p>
</dd>
<dt>stride :</dt><dd><p>Stride length over dataset</p>
</dd>
</dl>
</dd>
<dt>Default priors:</dt><dd><ul class="simple">
<li><p>HarmonicBonds, HarmonicAngles</p></li>
</ul>
</dd>
<dt>Optional priors:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Repulsion</dt><dd><ul>
<li><p>If repulsion prior is used, a custom neighbor list is created for the repulsion prior where all pairs of beads
not interacting through bonds and angles are included in the interaction set</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.download">
<span class="sig-name descname"><span class="pre">download</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.download"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.download" title="Link to this definition">¶</a></dt>
<dd><p>Downloads the dataset to the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.raw_dir</span></code> folder.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.kB">
<span class="sig-name descname"><span class="pre">kB</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.0019872041</span></span><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.kB" title="Link to this definition">¶</a></dt>
<dd><p>Boltzmann constant in kcal/mol/K</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.load_original_topology">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">load_original_topology</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pdb_file</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.load_original_topology"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.load_original_topology" title="Link to this definition">¶</a></dt>
<dd><p>Method to load origin topology</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pdb_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Path of all-atom PDB file</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Topology class object for all-atom molecule</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>topology</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.make_baseline_models">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">make_baseline_models</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priors_cls</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.make_baseline_models"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_baseline_models" title="Link to this definition">¶</a></dt>
<dd><p>Method to make all baseline models</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtomicData</span></code></a></span>) – AtomicData object of entire trajectory</p></li>
<li><p><strong>beta</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – 1/(k_B * T)</p></li>
<li><p><strong>priors_cls</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">_Prior</span></code>]</span>) – List of prior classes</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary of prior models fitted with the right harmonic restraint values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>baseline_models</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.make_cg_topology">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">make_cg_topology</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cg_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{('ACE',</span> <span class="pre">'C'):</span> <span class="pre">('CA_C',</span> <span class="pre">0,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'C'):</span> <span class="pre">('C_A',</span> <span class="pre">4,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'CA'):</span> <span class="pre">('CA_A',</span> <span class="pre">2,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'CB'):</span> <span class="pre">('CB_A',</span> <span class="pre">3,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'N'):</span> <span class="pre">('N_A',</span> <span class="pre">1,</span> <span class="pre">14),</span> <span class="pre">('NME',</span> <span class="pre">'N'):</span> <span class="pre">('N_N',</span> <span class="pre">5,</span> <span class="pre">14)}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">special_terminal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.make_cg_topology"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_cg_topology" title="Link to this definition">¶</a></dt>
<dd><p>Method to make Topology class object of CG molecule, creates custom bonds and angles to make a non-linear CG molecule</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topology</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>) – All-atom topology</p></li>
<li><p><strong>cg_mapping</strong> (<em>(</em><em>optional</em><em>)</em>) – Dictionary containing CG mapping. The default is AL_CG_MAP.</p></li>
<li><p><strong>special_terminal</strong> (<em>(</em><em>optional</em><em>)</em>) – True if termini beads are to be treated separately. The default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Topology class object for CG molecule</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>cg_topo</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.make_data_slices_prior">
<span class="sig-name descname"><span class="pre">make_data_slices_prior</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coords_forces_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cg_mapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cg_topo</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.make_data_slices_prior"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_data_slices_prior" title="Link to this definition">¶</a></dt>
<dd><p>Method to make collated AtomicData object, slices, and baseline models</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coords_forces_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – npz file containing the forces and coordinates from the all-atom simulation</p></li>
<li><p><strong>topology</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>) – Topology of all-atom model</p></li>
<li><p><strong>cg_mapping</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></span>) – Dictionary containing CG mapping.</p></li>
<li><p><strong>cg_topo</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>) – Topology of CG model</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtomicData</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ModuleDict</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>data_list_coll</em> – Collated AtomicData object</p></li>
<li><p><em>slices</em> – Dictionary containing slices of the AtomicData object</p></li>
<li><p><em>baseline_models</em> – Module dictionary containing fitted prior models</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.make_priors">
<span class="sig-name descname"><span class="pre">make_priors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">priors_cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cg_topo</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.make_priors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.make_priors" title="Link to this definition">¶</a></dt>
<dd><p>Method to make prior neighbor lists</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>priors_cls</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">_Prior</span></code>]</span>) – List of prior classes</p></li>
<li><p><strong>cg_topo</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary containing all prior neighbor lists</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>prior_nls</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cg_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{('ACE',</span> <span class="pre">'C'):</span> <span class="pre">('CA_C',</span> <span class="pre">0,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'C'):</span> <span class="pre">('C_A',</span> <span class="pre">4,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'CA'):</span> <span class="pre">('CA_A',</span> <span class="pre">2,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'CB'):</span> <span class="pre">('CB_A',</span> <span class="pre">3,</span> <span class="pre">12),</span> <span class="pre">('ALA',</span> <span class="pre">'N'):</span> <span class="pre">('N_A',</span> <span class="pre">1,</span> <span class="pre">14),</span> <span class="pre">('NME',</span> <span class="pre">'N'):</span> <span class="pre">('N_N',</span> <span class="pre">5,</span> <span class="pre">14)}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.process"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.process" title="Link to this definition">¶</a></dt>
<dd><p>Method for processing the raw data - this is where all processing function calls take place
All outputs are stored in the relevant processed files</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cg_mapping</strong> (<em>(</em><em>optional</em><em>)</em>) – CG mapping dictionary. The default is AL_CG_MAP.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.processed_file_names">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">processed_file_names</span></span><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.processed_file_names" title="Link to this definition">¶</a></dt>
<dd><p>The name of the files in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.processed_dir</span></code> folder that
must be present in order to skip processing.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.raw_file_names">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">raw_file_names</span></span><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.raw_file_names" title="Link to this definition">¶</a></dt>
<dd><p>The name of the files in the <code class="xref py py-obj docutils literal notranslate"><span class="pre">self.raw_dir</span></code> folder that must
be present in order to skip downloading.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.repulsion_nls">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">repulsion_nls</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cg_topo</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.repulsion_nls"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.repulsion_nls" title="Link to this definition">¶</a></dt>
<dd><p>Method for generating neighbor list for Repulsion prior - all interactions not included in bond or angle interactions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Name of prior class</p></li>
<li><p><strong>cg_topo</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="geometry/topology.html#mlcg.geometry.topology.Topology" title="mlcg.geometry.topology.Topology"><code class="xref py py-class docutils literal notranslate"><span class="pre">Topology</span></code></a></span>) – Topology object of CG molecule</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary containing repulsion neighor list</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.save_dataset">
<span class="sig-name descname"><span class="pre">save_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pickle_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/alanine_dipeptide.html#AlanineDataset.save_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.save_dataset" title="Link to this definition">¶</a></dt>
<dd><p>Method for saving dataset given pickle name</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pickle_name</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Name of pickle to store the dataset in</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="mlcg.datasets.alanine_dipeptide.AlanineDataset.temperature">
<span class="sig-name descname"><span class="pre">temperature</span></span><span class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">300</span></span><a class="headerlink" href="#mlcg.datasets.alanine_dipeptide.AlanineDataset.temperature" title="Link to this definition">¶</a></dt>
<dd><p>Temperature used to generate the underlying all-atom data in [K]</p>
</dd></dl>

</dd></dl>

<p id="module-mlcg.datasets.h5_dataset">Python classes for processing data stored in HDF5 format.</p>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h3>
<p>HDF5 format benefits the dataset management for mlcg-tools when training/validation involves multiple molecules of vastly different lengths and when parallelization is used.
The main features are:</p>
<ol class="arabic simple">
<li><p>The internal structure mimics the hierarchy of the dataset itself, such that we don’t have to replicate it on filesystem.</p></li>
<li><p>we don’t have to actively open all files in the process</p></li>
<li><p>we can transparently load only the necessary part of the dataset to the memory</p></li>
</ol>
<p>This file contains the python data structures for handling the HDF5 file and its content, i.e., the coordinates, forces and embedding vectors for multiple CG molecules.
An example HDF5 file structure and correponding class types after loading:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">/ (HDF-group, =&gt; `H5Dataset._h5_root`)
</span><span data-line="2">├── OPEP (HDF-group =(part, according to &quot;partition_options&quot;)=&gt; `Metaset` in a `Partition`)
</span><span data-line="3">│   ├── opep_0000 (HDF-group, =&gt; `MolData`)
</span><span data-line="4">│   │   ├── attrs (HDF-attributes of the molecule &quot;/OPEP/opep_0000&quot;)
</span><span data-line="5">│   │   │   ├── cg_embeds (a 1-d numpy.int array)
</span><span data-line="6">│   │   │   ├── N_frames (int, number of frames = size of cg_coords on axis 0)
</span><span data-line="7">│   │   │   ... (optional, e.g., cg_top, cg_pdb, etc that corrsponds to the molecule)
</span><span data-line="8">│   │   ├── cg_coords (HDF-dataset of the molecule &quot;/OPEP/opep_0000&quot;, 3-d numpy.float32 array)
</span><span data-line="9">│   │   └── cg(_delta)_forces (HDF-dataset of the molecule &quot;/OPEP/opep_0000&quot;, 3-d numpy.float32 array)
</span><span data-line="10">│   ... (other molecules in &quot;/OPEP&quot;)
</span><span data-line="11">├── CATH (HDF-group =&quot;partition_options&quot;=&gt; `Metaset` in a `Partition`)
</span><span data-line="12">...
</span></pre></div>
</div>
</section>
<section id="basic-bricks-moldata-and-metaset">
<h3>Basic bricks: <code class="docutils literal notranslate"><span class="pre">MolData</span></code> and <code class="docutils literal notranslate"><span class="pre">MetaSet</span></code><a class="headerlink" href="#basic-bricks-moldata-and-metaset" title="Link to this heading">¶</a></h3>
<p>Data structure <code class="docutils literal notranslate"><span class="pre">MolData</span></code> is the basic brick of the dataset.
It holds embeds, coords and forces of certain number of frames for a single molecule.
.sub_sample: method for performing indexing on the frames.</p>
<p>Data strucuture <code class="docutils literal notranslate"><span class="pre">Metaset</span></code> holds multiple molecules and joins their frame indices together.
One can access frames of underlying MolData objects with a continuous index.
The idea is that the molecules in a <code class="docutils literal notranslate"><span class="pre">Metaset</span></code> have similar numbers of CG beads, such that the sample requires similar processing time when passing through a neural network.
When this rule is enforced, it will allow automatic balancing of batch composition during training and validation.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.create_from_hdf5_group</span></code>: initiate a Metaset by loading data from given HDF-group.mol_list, detailed_indices, hdf_key_mapping, stride and parallel can control which subset is loaded to the Metaset (details see the description of “H5Dataset”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.trim_down_to</span></code>: drop frames of underlying for obtaining a subset with desired number of frames. The indices of frames to be dropped are controlled by a random number generator. When the parameter “random_seed” and the MolData order and number of frames are the same, the frames to be dropped will be reproducible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">len()</span> <span class="pre">(__len__)</span></code>: return total number of samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[]</span> <span class="pre">(__get_item__)</span></code>: infer the molecule and get the corresponding frame according to the given unified index. Return value is grouped by an <code class="docutils literal notranslate"><span class="pre">AtomicData</span></code> object.</p></li>
</ul>
<section id="train-test-split-partition">
<h4>Train test split: <code class="docutils literal notranslate"><span class="pre">Partition</span></code><a class="headerlink" href="#train-test-split-partition" title="Link to this heading">¶</a></h4>
<p>Data structure <code class="docutils literal notranslate"><span class="pre">Partition</span></code> can hold multiple Metaset for training and validation purposes.
Its main function is to automatic adjust (subsample) the Metaset(s) and the underlying MolData to form a balanced data source, from which a certain number of batches can be drawn. Each batch will contain a pre-given number of samples from each Metaset.
One or several <code class="docutils literal notranslate"><span class="pre">Partition``s</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">created</span> <span class="pre">to</span> <span class="pre">load</span> <span class="pre">part</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">HDF5</span> <span class="pre">file</span> <span class="pre">into</span> <span class="pre">the</span> <span class="pre">memory.</span>
<span class="pre">The</span> <span class="pre">exact</span> <span class="pre">content</span> <span class="pre">inside</span> <span class="pre">a</span> <span class="pre">``Partition</span></code> object is controlled by the <code class="docutils literal notranslate"><span class="pre">partition_options</span></code> as a parameter for initializing a <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code>.</p>
</section>
<section id="full-dataset-h5dataset">
<h4>Full Dataset: <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code><a class="headerlink" href="#full-dataset-h5dataset" title="Link to this heading">¶</a></h4>
<p>Data strcuture <code class="docutils literal notranslate"><span class="pre">H5Dataset</span></code> opens a HDF5 file and establish the partitions.
<code class="docutils literal notranslate"><span class="pre">partition_options</span></code> describe what partitions to create and what content to load into them. (Detailed description and examples are as followed.)
<code class="docutils literal notranslate"><span class="pre">loading_options</span></code> mainly deal with the HDF key mapping (which datasets/attributes corresponds to the coordinates, forces and embeddings) as well as (optionally) the information for correctly split the dataset in a parallel training/validation.</p>
<p>An example “partition_options” (as a Python Mappable (e.g., dict)):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">        <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="3">                <span class="s2">&quot;metasets&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="4">                        <span class="s2">&quot;OPEP&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="5">                                <span class="s2">&quot;molecules&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span data-line="6">                                        <span class="s2">&quot;opep_0000&quot;</span><span class="p">,</span>
</span><span data-line="7">                                        <span class="s2">&quot;opep_0001&quot;</span><span class="p">,</span>
</span><span data-line="8">                                        <span class="o">...</span>
</span><span data-line="9">                                <span class="p">],</span>
</span><span data-line="10">                                <span class="s2">&quot;stride&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># optional, default 1</span>
</span><span data-line="11">                                <span class="s2">&quot;detailed_indices&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="12">                <span class="c1"># optional, providing the indices of frames to work with (before striding and splitting for parallel processes).</span>
</span><span data-line="13">                                        <span class="c1"># optional,</span>
</span><span data-line="14">                    <span class="s2">&quot;opep_0000&quot;</span><span class="p">:</span>
</span><span data-line="15">                        <span class="n">val_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="16">                        <span class="n">test_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="17">                        <span class="n">seed</span><span class="p">:</span> <span class="mi">12345</span>
</span><span data-line="18">                    <span class="s2">&quot;opep_0001&quot;</span><span class="p">:</span>
</span><span data-line="19">                        <span class="n">val_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="20">                        <span class="n">test_ratio</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span data-line="21">                        <span class="n">seed</span><span class="p">:</span> <span class="mi">12345</span>
</span><span data-line="22">                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="o">./</span><span class="n">splits</span>
</span><span data-line="23">
</span><span data-line="24">                <span class="c1"># If detailed_indices are not provided for a given molecule, then it is equivalent to np.arange(N_frames)</span>
</span><span data-line="25">                                            <span class="s2">&quot;opep_0000&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span data-line="26">
</span><span data-line="27">
</span><span data-line="28">                                <span class="p">},</span>
</span><span data-line="29">                        <span class="p">},</span>
</span><span data-line="30">                        <span class="s2">&quot;CATH&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="31">                                <span class="s2">&quot;molecules&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span data-line="32">                                        <span class="s2">&quot;cath_1b43A02&quot;</span><span class="p">,</span>
</span><span data-line="33">                                        <span class="o">...</span>
</span><span data-line="34">                                <span class="p">],</span>
</span><span data-line="35">                                <span class="s2">&quot;stride&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># optional</span>
</span><span data-line="36">                                <span class="s2">&quot;detailed_indices&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="c1"># optional</span>
</span><span data-line="37">                        <span class="p">}</span>
</span><span data-line="38">                <span class="p">},</span>
</span><span data-line="39">                <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="40">                        <span class="c1"># each batch will contain 24 samples from</span>
</span><span data-line="41">                        <span class="c1"># The two metasets will be trimmed down according to this ratio</span>
</span><span data-line="42">                        <span class="c1"># so optimally it should be proportional to the ratio of numbers of frames in the metasets.</span>
</span><span data-line="43">                        <span class="s2">&quot;OPEP&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
</span><span data-line="44">                        <span class="s2">&quot;CATH&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
</span><span data-line="45">                <span class="p">},</span>
</span><span data-line="46">                <span class="s2">&quot;subsample_random_seed&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="c1"># optional, default 42. Random seed for trimming down the frames.</span>
</span><span data-line="47">                <span class="s2">&quot;max_epoch_samples&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># optional, default None. For setting a desired dataset size.</span>
</span><span data-line="48">                <span class="c1"># Works by subsampling the dataset after it is loaded with the given stride.</span>
</span><span data-line="49">        <span class="p">},</span>
</span><span data-line="50">        <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># similar</span>
</span><span data-line="51">        <span class="p">}</span>
</span><span data-line="52"><span class="p">}</span>
</span></pre></div>
</div>
<p>An example “loading_options” (as a Python Mappable (e.g., dict)):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">        <span class="s2">&quot;hdf_key_mapping&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="3">                <span class="c1"># keys for reading CG data from HDF5 groups</span>
</span><span data-line="4">                <span class="s2">&quot;embeds&quot;</span><span class="p">:</span> <span class="s2">&quot;attrs:cg_embeds&quot;</span><span class="p">,</span>
</span><span data-line="5">                <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="s2">&quot;cg_coords&quot;</span><span class="p">,</span>
</span><span data-line="6">                <span class="s2">&quot;forces&quot;</span><span class="p">:</span> <span class="s2">&quot;cg_delta_forces&quot;</span><span class="p">,</span>
</span><span data-line="7">        <span class="p">},</span>
</span><span data-line="8">        <span class="s2">&quot;parallel&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># optional, default rank=0 and world_size=1 (single process).</span>
</span><span data-line="9">                <span class="c1"># For split the dataset evenly and load only the necessary parts to each process in a parallelized train/val setup</span>
</span><span data-line="10">                <span class="s2">&quot;rank&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># which process is this</span>
</span><span data-line="11">                <span class="s2">&quot;world_size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># how many processes are there</span>
</span><span data-line="12">        <span class="p">}</span>
</span><span data-line="13"><span class="p">}</span>
</span></pre></div>
</div>
</section>
</section>
<section id="loading-into-pytorch-h5partitiondataloader">
<h3>Loading into PyTorch: <code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code><a class="headerlink" href="#loading-into-pytorch-h5partitiondataloader" title="Link to this heading">¶</a></h3>
<p>Class <code class="docutils literal notranslate"><span class="pre">H5PartitionDataLoader</span></code> mimics the pytorch data loader and can generate training/validation batches with fixed proportion of samples from several Metasets in a Partition.
The proportion and batch size is defined when the partition is initialized.
When the molecules in each Metaset have similar embedding vector lengths, the processing of output batches will require a more or less fixed size of VRAM on GPU, which can benefit the</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Usually in a train-val split, each molecule goes to either the train or the test partition.
In some special cases (e.g., non-transferable training) one molecule can be part of both partitions.
In this situation, “detailed_indices” can be set to assign the corresponding frames to the desired partitions.</p>
</div>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5Dataset">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5Dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h5_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_options</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loading_options</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_listed_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#H5Dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5Dataset" title="Link to this definition">¶</a></dt>
<dd><p>The top-level class for handling multiple datasets contained in a HDF5 file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>h5_file_path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Path to the hdf5 file containing the dataset(s)</p></li>
<li><p><strong>partition_options</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></span>) – Dictionary of partition names mapping to collections of metaset information</p></li>
<li><p><strong>loading_options</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></span>) – Dictionary of options specifying how hdf5 attrs/datasets are named
within hd5 groups</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5Dataset.training_validation_splitting">
<span class="sig-name descname"><span class="pre">training_validation_splitting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_detailed_indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">part_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metaset_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#H5Dataset.training_validation_splitting"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5Dataset.training_validation_splitting" title="Link to this definition">¶</a></dt>
<dd><p>Option to split molecule in metaset frame by frame into training or validation
Inputs:</p>
<blockquote>
<div><dl class="simple">
<dt>input_detailed_indices –</dt><dd><dl class="simple">
<dt>dictionary read in from yaml file about how data should be split</dt><dd><p>must contain 3 primary keys [val_ratio, test_ratio, seed]
additional option to write out to filename if in dict.keys()</p>
</dd>
</dl>
</dd>
<dt>part_name –</dt><dd><p>which partition is currently being examined</p>
</dd>
<dt>metaset_name –</dt><dd><p>global name describing class of molecules</p>
</dd>
<dt>mol_list –</dt><dd><p>names of molecules</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Outputs:</dt><dd><dl class="simple">
<dt>self._detailed_indices[part_name][metaset_name] –</dt><dd><p>pass back indices according to queried metaset and partition</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5MetasetDataLoader">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5MetasetDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metaset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collater_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;torch_geometric.loader.dataloader.Collater</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#H5MetasetDataLoader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5MetasetDataLoader" title="Link to this definition">¶</a></dt>
<dd><p>Load batches from one Metaset. For kwargs/options, see
<a class="reference external" href="https://pytorch.org/docs/stable/data.html?highlight=dataset#torch.utils.data.Dataset">https://pytorch.org/docs/stable/data.html?highlight=dataset#torch.utils.data.Dataset</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metaset</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></span>) – Dataset object for a single set of molecules</p></li>
<li><p><strong>batch_size</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Size of the batches to draw from the metaset</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5PartitionDataLoader">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5PartitionDataLoader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_partition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collater_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;torch_geometric.loader.dataloader.Collater</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#H5PartitionDataLoader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5PartitionDataLoader" title="Link to this definition">¶</a></dt>
<dd><p>Load batches from one or multiple Metasets in a Partition.
In multiple Metasets scenario, the order of data loaders will be
alphabetically ascending with respect to the Metaset names.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5SimpleDataset">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">H5SimpleDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">h5_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detailed_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metaset_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdf_key_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'coords':</span> <span class="pre">'cg_coords',</span> <span class="pre">'embeds':</span> <span class="pre">'attrs:cg_embeds',</span> <span class="pre">'forces':</span> <span class="pre">'cg_delta_forces'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'rank':</span> <span class="pre">0,</span> <span class="pre">'world_size':</span> <span class="pre">1}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_listed_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#H5SimpleDataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5SimpleDataset" title="Link to this definition">¶</a></dt>
<dd><p>The top-level class for handling a single dataset contained in a HDF5 file.
Will only load from one single type of molecules (i.e., one Metaset), and do
not support partition splits.
Use .get_dataloader for obtaining a dataloader for PyTorch training, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>h5_file_path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Path to the hdf5 file containing the dataset(s)</p></li>
<li><p><strong>stride</strong> (<em>default 1</em>) – Stride for loading the frames</p></li>
<li><p><strong>detailed_indices</strong> (default <cite>None</cite>) – Set this to manually define which frames to be included for each molecule.</p></li>
<li><p><strong>metaset_name</strong> (default <cite>None</cite>) – the name of the h5 group containing the molecule data. If kept <cite>None</cite> and
the given file consists of only one metaset, this parameter will be
inferred from the file.</p></li>
<li><p><strong>mol_list</strong> (default <cite>None</cite>) – A list of the molecules to be loaded. When kept <cite>None</cite>, all molecules will
be loaded.</p></li>
<li><p><strong>hdf_key_mapping</strong> (<em>default loading the delta forces</em>) – Key mapping for reading the data from h5 file.</p></li>
<li><p><strong>parallel</strong> (<em>default for single process</em>) – For DDP parallelism. Details see the head of this file.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.H5SimpleDataset.get_dataloader">
<span class="sig-name descname"><span class="pre">get_dataloader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collater_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">&lt;torch_geometric.loader.dataloader.Collater</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#H5SimpleDataset.get_dataloader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.H5SimpleDataset.get_dataloader" title="Link to this definition">¶</a></dt>
<dd><section id="parameters">
<h3>Parameters:<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h3>
<p>batch_size:
Size of the batches to draw from the metaset
collater_fn, shuffle, pin_memory:
See PyTorch documentations for dataloader options.</p>
</section>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">MetaSet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#MetaSet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet" title="Link to this definition">¶</a></dt>
<dd><p>Set of MolData instances for molecules with similar characterstics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> – Name of the metaset</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.create_from_hdf5_group">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">create_from_hdf5_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdf5_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detailed_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stride</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdf_key_mapping</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'coords':</span> <span class="pre">'cg_coords',</span> <span class="pre">'embeds':</span> <span class="pre">'attrs:cg_embeds',</span> <span class="pre">'forces':</span> <span class="pre">'cg_delta_forces',</span> <span class="pre">'weights':</span> <span class="pre">'subsampling_weights'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'rank':</span> <span class="pre">0,</span> <span class="pre">'world_size':</span> <span class="pre">1}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_using_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_listed_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#MetaSet.create_from_hdf5_group"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.create_from_hdf5_group" title="Link to this definition">¶</a></dt>
<dd><p>initiate a Metaset by loading data from given HDF-group.
mol_list, detailed_indices, hdf_key_mapping, stride and parallel can control which subset is loaded to the Metaset (details see the description of “H5Dataset”)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.grab_n_frames">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">grab_n_frames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdf5_group</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mol_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#MetaSet.grab_n_frames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.grab_n_frames" title="Link to this definition">¶</a></dt>
<dd><p>Returns number of frames for each mol name</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.retrieve_hdf">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">retrieve_hdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdf_grp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdf_key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#MetaSet.retrieve_hdf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.retrieve_hdf" title="Link to this definition">¶</a></dt>
<dd><p>Unified hdf retriever for attributes and dataset.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MetaSet.trim_down_to">
<span class="sig-name descname"><span class="pre">trim_down_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_n_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#MetaSet.trim_down_to"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MetaSet.trim_down_to" title="Link to this definition">¶</a></dt>
<dd><p>Trimming all datasets randomly to reach the target number of samples.
MolData attributes of the MetaSet are permanently subsampled by this
method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.MolData">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">MolData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embeds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclusion_pairs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#MolData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.MolData" title="Link to this definition">¶</a></dt>
<dd><p>Data-holder for coordinates, forces and embedding vector of a molecule, e.g., cath_1b43A02.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Name of the molecule</p></li>
<li><p><strong>embeds</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – Type embeddings for each atom, of shape <cite>(n_atoms,)</cite></p></li>
<li><p><strong>coords</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – Cartesian coordinates of the molecule, of shape <cite>(n_frames, n_atoms, 3)</cite></p></li>
<li><p><strong>forces</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></span>) – Cartesian forces of the molecule, of shape <cite>(n_frames, n_atoms, 3)</cite></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.Partition">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">mlcg.datasets.h5_dataset.</span></span><span class="sig-name descname"><span class="pre">Partition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#Partition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.Partition" title="Link to this definition">¶</a></dt>
<dd><p>Contain several metasets for a certain purpose, e.g., training.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>name</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – name of the partition</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlcg.datasets.h5_dataset.Partition.sampling_setup">
<span class="sig-name descname"><span class="pre">sampling_setup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_sizes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_epoch_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/datasets/h5_dataset.html#Partition.sampling_setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.datasets.h5_dataset.Partition.sampling_setup" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the number of batches available for an epoch according to
the batch size for each metaset and optionally the maximum number of
samples in an epoch. The molecular dataset will be trimmed accordingly.</p>
</dd></dl>

</dd></dl>

</section>
<section id="neighbor-list">
<h2>Neighbor List<a class="headerlink" href="#neighbor-list" title="Link to this heading">¶</a></h2>
<p>Main interface to the computation of neighborlists with a finite spherical cutoff</p>
<dl class="py function" id="module-mlcg.neighbor_list.neighbor_list">
<dt class="sig sig-object py" id="mlcg.neighbor_list.neighbor_list.atomic_data2neighbor_list">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.neighbor_list.</span></span><span class="sig-name descname"><span class="pre">atomic_data2neighbor_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_interaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nls_distance_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'torch'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/neighbor_list.html#atomic_data2neighbor_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.neighbor_list.atomic_data2neighbor_list" title="Link to this definition">¶</a></dt>
<dd><p>Build a neighborlist from a <span class="xref std std-ref">mlcg.data.AtomicData</span> by
searching for neighboring atom within a maximum radius <cite>rcut</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span class="xref std std-ref">mlcg.data.AtomicData</span>) – define an atomic structure</p></li>
<li><p><strong>rcut</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – cutoff radius used to compute the connectivity</p></li>
<li><p><strong>self_interaction</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – whether the mapping includes self referring mappings, e.g. mappings where <cite>i</cite> == <cite>j</cite>.</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – The maximum number of neighbors to return for each atom in <code class="xref py py-obj docutils literal notranslate"><span class="pre">data</span></code>.
If the number of actual neighbors is greater than
<code class="xref py py-obj docutils literal notranslate"><span class="pre">max_num_neighbors</span></code>, returned neighbors are picked randomly.</p></li>
<li><p><strong>nls_distance_method</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – Method for computing a neighbohr list. Suppoerted values are
<cite>torch</cite>, <cite>nvalchemi_naive</cite>, <cite>nvalchemi_cell</cite> and <cite>custom_kernel</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Neighborlist dictionary</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.neighbor_list.make_neighbor_list">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.neighbor_list.</span></span><span class="sig-name descname"><span class="pre">make_neighbor_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_mapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping_batch</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_shifts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_interaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/neighbor_list.html#make_neighbor_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.neighbor_list.make_neighbor_list" title="Link to this definition">¶</a></dt>
<dd><p>Build a neighbor_list dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tag</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – quick identifier for compatibility checking</p></li>
<li><p><strong>order</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – an int providing the order of the neighborlist, e.g. order == 2 means that
central atoms <cite>i</cite> have 1 neighbor <cite>j</cite> so distances can be computed,
order == 3 means that central atoms <cite>i</cite> have 2 neighbors <cite>j</cite> and <cite>k</cite> so
angles can be computed</p></li>
<li><p><strong>index_mapping</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span>) – The [order, n_edge] index tensor giving center -&gt; neighbor relations. 1st column
refers to the central atom index and the 2nd column to the neighbor atom
index in the list of atoms (so it has to be shifted by a cell_shift to get
the actual position of the neighboring atoms)</p></li>
<li><p><strong>mapping_batch</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – [n_edge] map for the neighbor -&gt; structure index relation</p></li>
<li><p><strong>cell_shifts</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span>) – A [n_edge, 3] tensor giving the periodic cell shift</p></li>
<li><p><strong>rcut</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</span>) – cutoff radius used to compute the connectivity</p></li>
<li><p><strong>self_interaction</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>]</span>) – whether the mapping includes self referring mappings, e.g. mappings where <cite>i</cite> == <cite>j</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Neighborlist dictionary</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.neighbor_list.validate_neighborlist">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.neighbor_list.</span></span><span class="sig-name descname"><span class="pre">validate_neighborlist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/neighbor_list.html#validate_neighborlist"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.neighbor_list.validate_neighborlist" title="Link to this definition">¶</a></dt>
<dd><p>Tool to validate that the neighborlist dictionary has the required fields</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>inp</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></span>) – Input neighborlist to be validated</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the supplied neighborlist is valid, false otherwise</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<p>Torch geometric implementation</p>
<dl class="py function" id="module-mlcg.neighbor_list.torch_impl">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.compute_images">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">compute_images</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_atoms</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#compute_images"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.compute_images" title="Link to this definition">¶</a></dt>
<dd><p>TODO: add doc</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.get_j_idx">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">get_j_idx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">edge_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_atoms</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#get_j_idx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.get_j_idx" title="Link to this definition">¶</a></dt>
<dd><p>TODO: add docs</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.safe_radius">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">safe_radius</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#safe_radius"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.safe_radius" title="Link to this definition">¶</a></dt>
<dd><p>A wrapper around torch_cluster.radius that disables torch.compile
when calling it, since currently torch.compile has issues with
certain parts of torch_cluster.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.safe_radius_graph">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">safe_radius_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#safe_radius_graph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.safe_radius_graph" title="Link to this definition">¶</a></dt>
<dd><p>A wrapper around torch_cluster.radius that disables torch.compile
when calling it, since currently torch.compile has issues with
certain parts of torch_cluster.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.strides_of">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">strides_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#strides_of"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.strides_of" title="Link to this definition">¶</a></dt>
<dd><p>TODO: add docs</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.torch_neighbor_list">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">torch_neighbor_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_interaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#torch_neighbor_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.torch_neighbor_list" title="Link to this definition">¶</a></dt>
<dd><p>Function for computing neighbor lists from pytorch geometric data
instances that may or may not use periodic boundary conditions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Data</span></code></span>) – Pytorch geometric data instance</p></li>
<li><p><strong>rcut</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – upper distance cutoff, in which neighbors with distances larger
than this cutoff will be excluded.</p></li>
<li><p><strong>self_interaction</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – If True, each atom will be considered it’s own neighbor. This can
be convenient for certain bases and representations</p></li>
<li><p><strong>num_workers</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Number of threads to spawn and use for computing the neighbor list</p></li>
<li><p><strong>max_number_neighbors</strong> – kwarg for radius_graph function from torch_cluster package,
specifying the maximum number of neighbors for each atom</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>torch.Tensor</em> – The atom indices of the first atoms in each neighbor pair</p></li>
<li><p><em>torch.Tensor</em> – The atom indices of the second atoms in each neighbor pair</p></li>
<li><p><em>torch.Tensor</em> – The cell shifts associated with minimum image distances
in the presence of periodic boundary conditions</p></li>
<li><p><em>torch.Tensor</em> – Mask for excluding self interactions</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.torch_neighbor_list_no_pbc">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">torch_neighbor_list_no_pbc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_interaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#torch_neighbor_list_no_pbc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.torch_neighbor_list_no_pbc" title="Link to this definition">¶</a></dt>
<dd><p>Function for producing torch neighborlists without periodic boundary
conditions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtomicData</span></code></a></span>) – AtomicData instance</p></li>
<li><p><strong>rcut</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – Upper distance cutoff for determining neighbor edges</p></li>
<li><p><strong>self_interaction</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>]</span>) – If True, self edges will added for each atom</p></li>
<li><p><strong>num_workers</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – Number of threads to use for neighbor enumeration</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – The maximum number of neighbors to return for each atom. For larger
systems, it is important to make sure that this number is sufficiently
large.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>torch.Tensor</em> – The first atoms in each edge</p></li>
<li><p><em>torch.Tensor</em> – The second atoms in each edge</p></li>
<li><p><em>torch.Tensor</em> – Boolean tensor identifying self_interacting edges</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.torch_neighbor_list_pbc">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">torch_neighbor_list_pbc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rcut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">self_interaction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#torch_neighbor_list_pbc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.torch_neighbor_list_pbc" title="Link to this definition">¶</a></dt>
<dd><p>Function for returning torch neighborlists from AtomicData instances
with periodic boundary conditions. The minimum image convention is used
for resolving periodic shifts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="data/atom_data.html#mlcg.data.atomic_data.AtomicData" title="mlcg.data.atomic_data.AtomicData"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtomicData</span></code></a></span>) – AtomicData instance</p></li>
<li><p><strong>rcut</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – Upper distance cutoff for determining neighbor edges</p></li>
<li><p><strong>self_interaction</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>]</span>) – If True, self edges will added for each atom</p></li>
<li><p><strong>num_workers</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – Number of threads to use for neighbor enumeration</p></li>
<li><p><strong>max_num_neighbors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span>) – The maximum number of neighbors to return for each atom. For larger
systems, it is important to make sure that this number is sufficiently
large.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>torch.Tensor</em> – The first atoms in each edge</p></li>
<li><p><em>torch.Tensor</em> – The second atoms in each edge</p></li>
<li><p><em>torch.Tensor</em> – Boolean tensor identifying self_interacting edges</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.neighbor_list.torch_impl.wrap_positions">
<span class="sig-prename descclassname"><span class="pre">mlcg.neighbor_list.torch_impl.</span></span><span class="sig-name descname"><span class="pre">wrap_positions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-07</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/neighbor_list/torch_impl.html#wrap_positions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.neighbor_list.torch_impl.wrap_positions" title="Link to this definition">¶</a></dt>
<dd><p>Wrap positions to unit cell.</p>
<p>Returns positions changed by a multiple of the unit cell vectors to
fit inside the space spanned by these vectors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Data</span></code></span>) – torch_geometric.Data instance</p></li>
<li><p><strong>eps</strong> (<em>float</em>) – Small number to prevent slightly negative coordinates from being
wrapped.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

<p>Utilities to compute the internal coordinates</p>
<p id="module-mlcg.geometry.internal_coordinates">TODO: write tests</p>
<dl class="py function">
<dt class="sig sig-object py" id="mlcg.geometry.internal_coordinates.compute_angles_cos">
<span class="sig-prename descclassname"><span class="pre">mlcg.geometry.internal_coordinates.</span></span><span class="sig-name descname"><span class="pre">compute_angles_cos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_shifts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/geometry/internal_coordinates.html#compute_angles_cos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.geometry.internal_coordinates.compute_angles_cos" title="Link to this definition">¶</a></dt>
<dd><p>Compute the cosine of the angle between the positions in <code class="xref py py-obj docutils literal notranslate"><span class="pre">pos</span></code> following the <code class="xref py py-obj docutils literal notranslate"><span class="pre">mapping</span></code> assuming that the mapping indices follow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">  <span class="n">j</span><span class="o">--</span><span class="n">k</span>
</span><span data-line="2"> <span class="o">/</span>
</span><span data-line="3"><span class="n">i</span>
</span></pre></div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\cos{\theta_{ijk}} &amp;= \frac{\mathbf{r}_{ij} \cdot \mathbf{r}_{jk}}{ \Vert \mathbf{r}_{ji}  \Vert \Vert \mathbf{r}_{kj} \Vert}  \\
\mathbf{r}_{ij} &amp;= \mathbf{r}_i - \mathbf{r}_j \\
\mathbf{r}_{kj} &amp;= \mathbf{r}_k - \mathbf{r}_j\end{split}\]</div>
</div>
<p>In the case of periodic boundary conditions, <code class="xref py py-obj docutils literal notranslate"><span class="pre">cell_shifts</span></code> must be
provided so that <span class="math notranslate nohighlight">\(\mathbf{r}_j\)</span> can be outside of the original unit
cell.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.geometry.internal_coordinates.compute_angles_raw">
<span class="sig-prename descclassname"><span class="pre">mlcg.geometry.internal_coordinates.</span></span><span class="sig-name descname"><span class="pre">compute_angles_raw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_shifts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/geometry/internal_coordinates.html#compute_angles_raw"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.geometry.internal_coordinates.compute_angles_raw" title="Link to this definition">¶</a></dt>
<dd><p>Compute the raw angle (in radians) between the positions in <code class="xref py py-obj docutils literal notranslate"><span class="pre">pos</span></code> following the <code class="xref py py-obj docutils literal notranslate"><span class="pre">mapping</span></code> assuming that the mapping indices follow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">  <span class="n">j</span><span class="o">--</span><span class="n">k</span>
</span><span data-line="2"> <span class="o">/</span>
</span><span data-line="3"><span class="n">i</span>
</span></pre></div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\theta_{ijk} = &amp;\text{atan2}(\Vert \hat{\mathbf{n}} \vert, \mathbf{r}_{ij} \cdot \mathbf{r}_{kj} ) \\
\mathbf{r}_{ij} &amp;= \mathbf{r}_i - \mathbf{r}_j \\
\mathbf{r}_{kj} &amp;= \mathbf{r}_k - \mathbf{r}_j \\
\mathbf{\hat{n}} &amp;= \frac{\mathbf{r}_{ij} \times \mathbf{r}_{kj}}{\Vert \mathbf{r}_{ij} \times \mathbf{r}_{kj} \Vert}\end{split}\]</div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.geometry.internal_coordinates.compute_distance_vectors">
<span class="sig-prename descclassname"><span class="pre">mlcg.geometry.internal_coordinates.</span></span><span class="sig-name descname"><span class="pre">compute_distance_vectors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_shifts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/geometry/internal_coordinates.html#compute_distance_vectors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.geometry.internal_coordinates.compute_distance_vectors" title="Link to this definition">¶</a></dt>
<dd><p>Compute the distance (or displacement) vectors between the positions in
<code class="xref py py-obj docutils literal notranslate"><span class="pre">pos</span></code> following the <code class="xref py py-obj docutils literal notranslate"><span class="pre">mapping</span></code> assuming that that mapping indices follow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">i</span><span class="o">--</span><span class="n">j</span>
</span></pre></div>
</div>
<p>such that:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}r_{ij} &amp;= ||\mathbf{r}_j - \mathbf{r}_i||_{2} \\
\hat{\mathbf{r}}_{ij} &amp;= \frac{\mathbf{r}_{ij}}{r_{ij}}\end{split}\]</div>
</div>
<p>In the case of periodic boundary conditions, <code class="xref py py-obj docutils literal notranslate"><span class="pre">cell_shifts</span></code> must be
provided so that <span class="math notranslate nohighlight">\(\mathbf{r}_j\)</span> can be outside of the original unit
cell.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.geometry.internal_coordinates.compute_distances">
<span class="sig-prename descclassname"><span class="pre">mlcg.geometry.internal_coordinates.</span></span><span class="sig-name descname"><span class="pre">compute_distances</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_shifts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/geometry/internal_coordinates.html#compute_distances"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.geometry.internal_coordinates.compute_distances" title="Link to this definition">¶</a></dt>
<dd><p>Compute the distance between the positions in <code class="xref py py-obj docutils literal notranslate"><span class="pre">pos</span></code> following the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">mapping</span></code> assuming that mapping indices follow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">i</span><span class="o">--</span><span class="n">j</span>
</span></pre></div>
</div>
<p>such that:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[r_{ij} = ||\mathbf{r}_j - \mathbf{r}_i||_{2}\]</div>
</div>
<p>In the case of periodic boundary conditions, <code class="xref py py-obj docutils literal notranslate"><span class="pre">cell_shifts</span></code> must be
provided so that <span class="math notranslate nohighlight">\(\mathbf{r}_j\)</span> can be outside of the original unit
cell.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.geometry.internal_coordinates.compute_torsions">
<span class="sig-prename descclassname"><span class="pre">mlcg.geometry.internal_coordinates.</span></span><span class="sig-name descname"><span class="pre">compute_torsions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/geometry/internal_coordinates.html#compute_torsions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.geometry.internal_coordinates.compute_torsions" title="Link to this definition">¶</a></dt>
<dd><p>Compute the angle between two planes from positions in :obj:’pos’ following the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">mapping</span></code>:</p>
<p>For dihedrals: the angle w.r.t. position of i&amp;l is positive if l i rotated clockwise
when staring down bond jk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">  <span class="n">j</span><span class="o">--</span><span class="n">k</span><span class="o">--</span><span class="n">l</span>
</span><span data-line="2"> <span class="o">/</span>
</span><span data-line="3"><span class="n">i</span>
</span></pre></div>
</div>
<p>For impropers: the angle is positive if when looking in plane ikj, l is rotated clockwise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">k</span>
</span><span data-line="2"> \\
</span><span data-line="3">  <span class="n">l</span><span class="o">--</span><span class="n">j</span>
</span><span data-line="4"> <span class="o">/</span>
</span><span data-line="5"><span class="n">i</span>
</span></pre></div>
</div>
<p>The angle is computed using the formula:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\phi_{ijkl} &amp;= \text{atan2}(-\mathbf{m} \cdot \mathbf{n}_2, \mathbf{n}_2 \cdot \mathbf{n}_1) \\
\mathbf{n}_1 &amp;= \mathbf{\hat{r}}_{ji} \times \mathbf{\hat{r}}_{kj} \\
\mathbf{n}_2 &amp;= \mathbf{\hat{r}}_{kj} \times \mathbf{\hat{r}}_{jl} \\
\mathbf{m} &amp;= \mathbf{n}_{1} \times \mathbf{\hat{r}}_{kj}\end{split}\]</div>
</div>
<p>Where the <span class="math notranslate nohighlight">\(\hat{u}\)</span> indicates a normalized vector in direction of <span class="math notranslate nohighlight">\(u\)</span>.
The order and signs in the atan2 arguments are needed to obtain values consistent
with mdtraj. In the case of periodic boundary conditions, <code class="xref py py-obj docutils literal notranslate"><span class="pre">cell_shifts</span></code> must be
provided so that <span class="math notranslate nohighlight">\(\mathbf{r}_j\)</span> can be outside of the original unit
cell.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.geometry.internal_coordinates.safe_norm">
<span class="sig-prename descclassname"><span class="pre">mlcg.geometry.internal_coordinates.</span></span><span class="sig-name descname"><span class="pre">safe_norm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keepdims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-16</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/geometry/internal_coordinates.html#safe_norm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.geometry.internal_coordinates.safe_norm" title="Link to this definition">¶</a></dt>
<dd><p>Compute Euclidean norm of input so that 0-norm vectors can be used in
the backpropagation</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlcg.geometry.internal_coordinates.safe_normalization">
<span class="sig-prename descclassname"><span class="pre">mlcg.geometry.internal_coordinates.</span></span><span class="sig-name descname"><span class="pre">safe_normalization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norms</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mlcg/geometry/internal_coordinates.html#safe_normalization"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlcg.geometry.internal_coordinates.safe_normalization" title="Link to this definition">¶</a></dt>
<dd><p>Normalizes input using norms avoiding divitions by zero</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></span></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="simulations">
<h2>Simulations<a class="headerlink" href="#simulations" title="Link to this heading">¶</a></h2>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Clementi Group</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="_static/documentation_options.js?v=360bc84d"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="_static/shibuya.js?v=cac61aee"></script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script></body>
</html>